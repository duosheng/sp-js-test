{"version":3,"sources":["mobile.js"],"names":["window","session","xd_phone","checkLogin_second","cts2","cts","location","$","click","length","set","Date","getTime","attr","val","setProgressMax","xd_progressMax","require","nowMonth","today","getFullYear","parmMonth","num","size","s","getDetailInfo","req","data","total","start","time","spiderData","code","checkSmsTime","finish","msg","monthArray","Array","i","nowYear","mm","push","get","phone","mobile","xd_user_info","household_address","contactNum","registration_time","inNetDate","xdProcessData","xd_monthDataCount","startSpiderMonthData","index","fee","obj","Object","pushCallDetailData","month","setProgress","upload","monthData","xd_callBill","xd_cid","zfill","substr","value","call","wrapCall","commMode","anotherNm","setTimeout","xd_check","send_second_sms","req1","succ","myDate","stclog","type","url","async","timeout","dataType","jsonpCallback","userName","resultCode","alert","fffirst","error","request","strStatus","thrown","but","xd_pwd","smscode","submitDetailVec","maskDiv","showProgress","append","css","opacity","position","top","left","background-color","width","height","z-index","title1","text","font-size","inputPwd","title1Left","inputPwdTop","title2","offset","title2Top","inputSms","inputSmsTop","input","certificateBtn","hide","test","verify_second_sms","countdown","removeAttribute","setAttribute","settime"],"mappings":"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","file":"../mobile.js","sourcesContent":["dSpider(\"mobile\",function(session,env,$) {\n\n    checkLogin_first();\n\n    // -------------------------------------------\n    function checkLogin_first() {\n\n        var xd_phone = session.get(\"xd_phone\");\n        window.xd_phone = xd_phone;\n        if (window.xd_phone) {\n            session.autoLoadImg(false)\n            checkLogin_second();\n            return;\n        }\n\n        var cts = 'login.10086.cn';\n        var cts2 = 'channelID';\n        if (window.location.href.indexOf(cts) >= 0 && window.location.href.indexOf(cts2) >= 0) {\n\n            if ($('#getSMSpwd').length) {\n                $('#getSMSpwd').click(function () {\n                    session.set(\"firstSMSTime\",new Date().getTime() + '');\n                });\n            }\n\n            if ($('#getPhoneSMSpwd').length) {\n                $('#getPhoneSMSpwd').click(function () {\n                    session.set(\"firstSMSTime\",new Date().getTime() + '');\n                });\n            }\n\n            $('#submit_bt').click(function () {\n\n                //存储手机号\n                if ($('#account_nav').attr('class') == 'on') {\n                    session.set(\"xd_phone\",$('#p_phone_account').val());\n                } else {\n                    session.set(\"xd_phone\",$('#p_phone').val());\n                }\n\n                if ($('#p_sms').val() == '') {\n                    session.set(\"firstSMSTime\",'0');\n                }\n            });\n        }\n    }\n\n    function checkLogin_second() {\n\n        //手机号和密码未就绪的\n        if (!window.xd_phone) return;\n        var cts = 'shop.10086.cn/i/?f=billdetailqry&welcome=';\n        if (window.location.href.indexOf(cts) >= 0) {\n            var phone = window.xd_phone;\n            //检测是否需要登陆短信\n            session.showProgress()\n            session.setProgressMax(7)\n            window.xd_progressMax = 1;\n            session.setProgress(window.xd_progressMax)\n            window.xd_data = new Object();\n            checkSec();\n        }\n    }\n\n    function checkSec() {\n\n        //检测是否需要二次验证 or 拿取数据\n        (function () {\n            require([\"/i/service/model/fee_c3dfbd6.js\", \"/i/apps/serviceapps/billdetail/billdetailone_288e057.js\", \"/i/nresource/js/page/pages.js\", \"btncommit\", \"/i/apps/serviceapps/billdetail/billdetailtwo_00c3bc9.js\"], function (fee, billdetailone, page, btn, billdetailtwo) {\n\n                //req = [\"18310346355\", 1, 50, \"201611\", \"02\"];\n                //[\"18310346355\", 第1页, 请求50个, \"201611\", \"02\"]\n\n                var today = new Date();//获得当前日期\n                var nowMonth = today.getMonth() + 1;//此方法获得的月份是从0---11，所以要加1才是当前月份\n                var nowYear = today.getFullYear();\n\n                var parmMonth = (function zfill(num, size) {\n                    var s = \"000000000\" + num;\n                    return s.substr(s.length - size);\n                }(nowMonth, 2));\n\n                var req = [window.xd_phone, 1, 50, '' + nowYear + parmMonth, '02'];\n                fee.getDetailInfo(req, function (data, total, start, end, time) {\n                    //可以拿数据了\n                    spiderData();\n                }, function (code, msg, sOperTime) {\n                    // log(\"fail\");\n                    if (code == \"520001\" || code == \"3018\") { //需要短信二次认证\n                        // log('\\n----需要验证码-----\\n');\n                        checkSmsTime();\n                    } else {\n                        // log('\\n----未知错误-----\\n');\n                        session.finish(msg, '二次验证请求发生错误', code);\n                    }\n                }, function (code, msg, sOperTime) {\n                    // log('\\n----error-----\\n');\n                    session.finish(msg, '二次验证请求发生错误', code);\n                });\n            });\n        }());\n    }\n\n    function monthArray() {\n        var monthArray = new Array();\n        var today = new Date();//获得当前日期\n        for (var i = 0; i < 6; i++) {\n            var nowMonth = today.getMonth() + 1;//此方法获得的月份是从0---11，所以要加1才是当前月份\n            var nowYear = today.getFullYear();\n\n            var mm = nowMonth - i;\n            if (mm <= 0) {\n                nowYear--;\n                mm += 12;\n            }\n\n            var parmMonth = (function zfill(num, size) {\n                var s = \"000000000\" + num;\n                return s.substr(s.length - size);\n            }(mm, 2));\n\n            monthArray.push('' + nowYear + parmMonth);\n        }\n        return monthArray;\n    }\n\n    function getMyUserInfo(phone) {\n\n        var url = 'http://shop.10086.cn/i/v1/cust/info/' + phone + '?time=' + new Date().getTime();\n        $.get(url, function (result) {\n\n            var data = result.data;\n\n            var xd_user_info = {\n                'mobile':window.xd_phone,\n                'name': data.name,\n                'household_address': data.address,\n                'contactNum': data.contactNum,\n                'registration_time': data.inNetDate,\n            };\n\n            window.xd_data['user_info'] = xd_user_info;\n            window.xd_progressMax++;\n            session.setProgress(window.xd_progressMax);\n            xdProcessData();\n        });\n    }\n\n    function spiderData() {\n\n        //爬取用户信息\n        getMyUserInfo(window.xd_phone);\n\n        //爬取用户通话详单\n        window.monthArray = monthArray();\n        for (var i = 0; i < window.monthArray.length; i++) {\n            window.xd_monthDataCount = 0;\n            var month = window.monthArray[i];\n            startSpiderMonthData(month);\n        }\n    }\n\n    function startSpiderMonthData(month, index) {\n\n        if (arguments.length == 1) {\n            index = 1;\n        }\n\n        (function () {\n            require([\"/i/service/model/fee_c3dfbd6.js\", \"/i/apps/serviceapps/billdetail/billdetailone_288e057.js\", \"/i/nresource/js/page/pages.js\", \"btncommit\", \"/i/apps/serviceapps/billdetail/billdetailtwo_00c3bc9.js\"], function (fee, billdetailone, page, btn, billdetailtwo) {\n\n                //req = [\"18310346355\", 1, 50, \"201611\", \"02\"];\n                //[\"18310346355\", 第1页, 请求50个, \"201611\", \"02\"]\n\n                req = [window.xd_phone, index, 50, month, \"02\"];\n                fee.getDetailInfo(req, function (data, total, start, end, time) {\n\n                    // log('\\n----succ-----\\n');\n                    //详单数据\n                    // log(data);\n\n                    var key = month + '.' + index;\n\n                    if (total != 0) {\n\n                        var obj = new Object();\n                        obj['month'] = month;\n                        obj['value'] = data;\n                        obj['total'] = total;\n                        pushCallDetailData(obj);\n\n                        if (index * 50 >= total) {\n                            //此月爬完\n                            window.xd_progressMax++;\n                            session.setProgress(window.xd_progressMax);\n                            window.xd_monthDataCount++;\n\n\n                            if (window.xd_monthDataCount >= 6) {\n                                xdProcessData();\n                            }\n                        } else {\n                            index++;\n                            startSpiderMonthData(month, index);\n                        }\n\n                    } else {\n\n                        var value = '您选择的时间段内没有详单记录哦';\n                        //此月爬完push\n                        var obj = new Object();\n                        obj['month'] = month;\n                        obj['value'] = new Array();\n                        obj['total'] = 0;\n                        pushCallDetailData(obj);\n\n                        window.xd_monthDataCount++;\n                        window.xd_progressMax++;\n                        session.setProgress(window.xd_progressMax);\n                        if (window.xd_monthDataCount >= 6) {\n                            xdProcessData();\n                        }\n                    }\n                }, function (code, msg, sOperTime) {\n\n                    //时间段内没有详单记录\n                    if (code == '2039') {\n                        var key = month + '.' + index;\n                        var value = '您选择的时间段内没有详单记录哦';\n                        //此月爬完push\n                        var obj = new Object();\n                        obj['month'] = month;\n                        obj['value'] = new Array();\n                        obj['total'] = 0;\n                        pushCallDetailData(obj);\n\n                        window.xd_monthDataCount++;\n                        window.xd_progressMax++;\n                        session.setProgress(window.xd_progressMax);\n                        if (window.xd_monthDataCount >= 6) {\n                            xdProcessData();\n                        }\n\n                    } else {\n                        if (code == \"520001\" || code == \"3018\") { //需要短信二次认证\n                            // log('\\n----需要验证码-----\\n');\n                            checkSmsTime();\n                        } else {\n                            // log('\\n----未知错误-----\\n');\n\n                            var obj = new Object();\n                            obj['month'] = month;\n                            obj['value'] = new Array();\n                            obj['total'] = total;\n                            obj['state'] = 2;\n\n                            if (index == 1) {\n                                //此月爬完\n                                window.xd_progressMax++;\n                                session.setProgress(window.xd_progressMax);\n                                window.xd_monthDataCount++;\n                            } else {\n                                obj['state'] = 5;\n                            }\n                            pushCallDetailData(obj);\n\n                            if (window.xd_monthDataCount >= 6) {\n                                xdProcessData();\n                            }\n                        }\n                    }\n                }, function (code, msg, sOperTime) {\n\n                    // log('\\n----error-----\\n');\n\n                    var obj = new Object();\n                    obj['month'] = month;\n                    obj['value'] = new Array();\n                    obj['total'] = 0;\n                    obj['state'] = 2;\n\n                    if (index == 1) {\n                        //此月爬完\n                        window.xd_progressMax++;\n                        session.setProgress(window.xd_progressMax);\n                        window.xd_monthDataCount++;\n                    } else {\n                        obj['state'] = 5;\n                    }\n                    pushCallDetailData(obj);\n\n                    if (window.xd_monthDataCount >= 6) {\n                        xdProcessData();\n                    }\n                });\n            });\n        }());\n    }\n\n    //整理详单数据\n    function xdProcessData() {\n\n        if (window.xd_data.user_info && window.xd_monthDataCount >= 6) {\n\n            window.xd_data['month_status'] = window.xd_callBill;\n            session.upload(window.xd_data);\n            session.finish();\n        }\n    }\n\n    //存储详单数据\n    function pushCallDetailData(data) {\n\n        if (!window.xd_callBill) {\n            window.xd_callBill = new Array();\n        }\n\n        var monthData = null;\n        if (window.xd_callBill.length > 0) {\n            //查看是不是已经有此月份了\n            for (var i = 0; i < window.xd_callBill.length; i++) {\n                var obj = window.xd_callBill[i];\n                if (obj.calldate.indexOf(data.month) >= 0) {\n                    //有此月份\n                    monthData = obj;\n                    break;\n                }\n            }\n        }\n\n        //第一次添加月份\n        if (monthData == null) {\n\n            var time = new Date().getTime();\n            var xd_cid = (function zfill(num, size) {\n                var s = \"000000000\" + num;\n                return s.substr(s.length - size);\n            }(time, 10));\n\n            monthData = new Object();\n            monthData['data'] = new Array();\n            monthData['calldate'] = data.month;\n            monthData['totalCount'] = data.total;\n            monthData['mobile'] = window.xd_phone;\n            monthData['cid'] = xd_cid;\n            monthData['status'] = 4;\n            window.xd_callBill.push(monthData);\n        }\n\n        if (data.status){\n            monthData['status'] = data.status;\n        }\n\n        if (data.value.length > 0) {\n            for (var i = 0; i < data.value.length; i++) {\n\n                var call = data.value[i];\n                var wrapCall = new Object();\n                wrapCall['callFee'] = call.commFee;\n                wrapCall['remoteType'] = call.commType;\n                wrapCall['callType'] = call.commMode;\n                wrapCall['callTime'] = call.commTime;\n                wrapCall['callAddress'] = call.commPlac;\n                wrapCall['callBeginTime'] = call.startTime;\n                wrapCall['otherNo'] = call.anotherNm;\n                wrapCall['taocan'] = call.mealFavorable;\n                monthData.data.push(wrapCall);\n            }\n        }\n    }\n\n\n    function checkSmsTime() {\n        var time = session.get(\"firstSMSTime\");\n\n        window.firstSmsTm = parseInt(time);\n        setTimeout(xd_check, 1000);\n    }\n\n    function xd_check() {\n\n        if ((window.firstSmsTm + 30 * 1000) < new Date().getTime()) {\n\n            showMask(true);\n            $('#sendSmsBtn').click(function () {\n                send_second_sms();\n            });\n        } else {\n            setTimeout(xd_check, 1000);\n        }\n    };\n\n    function send_second_sms() {\n        //发送二次短信\n        // alert('sec-send-' + window.firstSmsTm);\n        var req1 = [\"https://login.10086.cn\", window.xd_phone];\n        (function (req, succ, fail) {\n            require([\"stclog\"], function (stclog) {\n                var myDate = new Date();\n                $.ajax({\n                    type: 'POST',\n                    url: req[0] + '/sendSMSpwd.action',\n                    async: false,\n                    timeout: 10,\n                    dataType: 'jsonp',\n                    jsonpCallback: \"result\",\n                    data: {\n                        userName: req[1]\n                    },\n                    success: function (data) {\n\n                        if (data.resultCode == \"error\") {\n                            // alert(\"系统异常！\");\n                            alert(\"发生未知错误，请稍后重试\");\n                        } else {\n                            if (!window.fffirst) {\n                                alert(\"短信已发送, 如果您未收到，请60秒后重试\");\n                                window.fffirst = true;\n                            } else {\n                                alert(\"短信已发送!\");\n                            }\n                        }\n                    },\n                    error: function (request, strStatus, thrown) {\n                        // alert(\"系统异常！\");\n                        alert(\"发生未知错误，请稍后重试\");\n                        return;\n                    }\n                });\n            })\n        }(req1, null, null));\n    }\n\n    function verify_second_sms(smscode) {\n\n        //验证二次短信\n        (function (_phone, but) {\n            require([\"/i/service/model/fee_c3dfbd6.js\", \"pluspop\", \"btncommit\"], function (fee, poptool, btnCommit) {\n\n                req = [\"https://login.10086.cn\"];\n                req.push(window.xd_phone);\n                req.push(window.xd_pwd);\n                req.push(smscode);\n                req.push(\"01\", \"\", \"12003\", \"01\");\n                fee.submitDetailVec(req, function (data) {\n                    // log('\\n----短信验证成功-----\\n');\n\n                    showMask(false);\n                    spiderData();\n\n                }, function (code, msg) {\n                    alert(msg);\n                });\n            });\n        }(window.xd_phone, null));\n    }\n\n    function showMask(isShow) {\n\n        if (!isShow) {\n            session.showProgress();\n        } else {\n            session.showProgress(false);\n\n        }\n\n        if (isShow) {\n            if ($('#maskDiv').length == 0) {\n                var maskDiv = $('<div></div>');        //创建一个父div\n                maskDiv.attr('id', 'maskDiv');        //给父div设置id\n                $(\"body\").append(maskDiv);\n                $(\"#maskDiv\").css({\n                    'opacity': 1,\n                    'position': 'absolute',\n                    'top': 0,\n                    'left': 0,\n                    'background-color': '#AAAAAA',\n                    'width': '200%',\n                    'height': '200%',\n                    'z-index': 10000\n                });\n\n                //提示1\n                var title1 = $($('<p><p/>'));\n                title1.text('请输入服务密码：');\n                $(\"#maskDiv\").append(title1);\n                title1.css({\n                    'position': 'absolute',\n                    'left': '30px',\n                    'top': '200px',\n                    'height': '60px',\n                    'width': '300px',\n                    'font-size': '30px',\n                });\n\n                //密码输入框\n                var inputPwd = $('<input type=\"text\" id=\"inputPwd\"/>');\n                $(\"#maskDiv\").append(inputPwd);\n\n                var title1Left = title1.offset().left + 'px';\n                var inputPwdTop = title1.offset().top + title1.height() + 10 + 'px';\n                $('#inputPwd').css({\n                    'position': 'absolute',\n                    'left': title1Left,\n                    'top': inputPwdTop,\n                    'height': '60px',\n                    'width': '300px',\n                    'font-size': '20x',\n                    'background-color': 'yellow',\n                });\n\n                //提示2\n                var title2 = $($('<p><p/>'));\n                title2.text('请输入短信验证码：');\n                $(\"#maskDiv\").append(title2);\n\n                var title2Top = $('#inputPwd').offset().top + $('#inputPwd').height() + 50 + 'px';\n                title2.css({\n                    'position': 'absolute',\n                    'left': title1Left,\n                    'top': title2Top,\n                    'height': '60px',\n                    'width': '300px',\n                    'font-size': '30px',\n                });\n\n                //短信输入框\n                var inputSms = $('<input type=\"text\" id=\"inputSms\"/>');\n                $(\"#maskDiv\").append(inputSms);\n\n                var inputSmsTop = title2.offset().top + title2.height() + 10 + 'px';\n                $('#inputSms').css({\n                    'position': 'absolute',\n                    'left': title1Left,\n                    'top': inputSmsTop,\n                    'height': '60px',\n                    'width': '300px',\n                    'font-size': '30px',\n                    'background-color': 'yellow',\n                });\n\n                //发送短信\n                var input = $('<input type=\"button\" id=\"sendSmsBtn\" value=\"免费获取验证码\"/>').click(settime);\n                $(\"#maskDiv\").append(input);\n\n                $('#sendSmsBtn').css({\n                    'position': 'absolute',\n                    'left': $('#inputSms').offset().left + $('#inputSms').width() + 30 + 'px',\n                    'top': $('#inputSms').offset().top + 'px',\n                    'height': '60px',\n                    'width': '200px',\n                    'font-size': '30px',\n                    'background-color': 'green',\n                });\n\n                //认证\n                var certificateBtn = $('<input type=\"button\" id=\"certificateBtn\" value=\"去认证\"/>').click(certificateBtnAction);\n                $(\"#maskDiv\").append(certificateBtn);\n\n                $('#certificateBtn').css({\n                    'position': 'absolute',\n                    'left': title1Left,\n                    'top': $('#inputSms').offset().top + $('#inputSms').height() + 50 + 'px',\n                    'height': '60px',\n                    'width': '300px',\n                    'font-size': '30px',\n                    'background-color': 'green',\n                });\n\n            } else {\n                $('#maskDiv').show();\n            }\n        } else {\n            if ($('#maskDiv').lensgth != 0) {\n                $('#maskDiv').hide();\n            }\n        }\n    }\n\n    function certificateBtnAction() {\n        window.xd_pwd = $('#inputPwd').val();\n\n        if (!/^\\d{6}$/.test(window.xd_pwd)) {\n            alert('请输入6位服务密码！');\n            return;\n        }\n\n        if (!/^\\d{6}$/.test($('#inputSms').val())) {\n            alert('请输入6位短信验证码！');\n            return;\n        }\n\n        verify_second_sms($('#inputSms').val());\n    }\n\n    window.countdown = 60;\n    function settime() {\n\n        var obj = $('#sendSmsBtn')[0];\n        if (window.countdown == 0) {\n            obj.removeAttribute(\"disabled\");\n            obj.value = \"免费获取验证码\";\n            window.countdown = 60;\n            return;\n        } else {\n            window.xd_pwd = $('#inputPwd').val();\n            obj.setAttribute(\"disabled\", true);\n            obj.value = \"重新发送(\" + window.countdown + \")\";\n            window.countdown--;\n        }\n        setTimeout(function () {\n                settime()\n            }\n            , 1000);\n    };\n});"]}