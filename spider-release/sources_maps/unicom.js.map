{"version":3,"sources":["unicom.js"],"names":["dSpider","session","env","$","parseThxd","msg","find","each","data","text","first","replace","length","monthData","get","datas","push","set","log","JSON","stringify","getThxdByAjax","year","month","curMonthData","parseInt","Date","getTime","toString","ajax","url","type","success","html","window","totalrow","endrow","loadMore","thxd","spide","error","xhr","_this","beginrow","perrow","href","getrandom","params","pagenum","load","monthArr","setProgress","monthObj","shift","location","endSpide","upload","finish","showProgress","indexOf","footer","css","header","passFind","loginBtn","click","unameInput","userName","val","setLocal","passInput","pass","getLocal","setStartUrl","curMonth","curYear","ul","has","li","trim","e","date","getMonth","getFullYear","max","i","setProgressMax","infoTag","attr","userInfo","len"],"mappings":";;AAAAA,QAAQ,QAAR,EAAkB,KAAG,CAArB,EAAwB,UAASC,OAAT,EAAiBC,GAAjB,EAAqBC,CAArB,EAAuB;;AAE3C,aAASC,SAAT,CAAmBC,GAAnB,EAAwB;AACpBF,UAAEE,GAAF,EAAOC,IAAP,CAAY,cAAZ,EAA4BC,IAA5B,CAAiC,YAAW;AACxC,gBAAIC,OAAO,EAAX;AACAA,iBAAK,SAAL,IAAkBL,EAAE,IAAF,EAAQG,IAAR,CAAa,gBAAb,EAA+BG,IAA/B,EAAlB;AACAD,iBAAK,UAAL,IAAmBL,EAAE,IAAF,EAAQG,IAAR,CAAa,YAAb,EAA2BI,KAA3B,GAAmCD,IAAnC,EAAnB;AACAD,iBAAK,SAAL,IAAkBL,EAAE,IAAF,EAAQG,IAAR,CAAa,cAAb,EAA6BG,IAA7B,GAAoCE,OAApC,CAA4C,UAA5C,EAAwD,EAAxD,EAA4DA,OAA5D,EAAlB;AACAH,iBAAK,eAAL,IAAwBL,EAAE,IAAF,EAAQG,IAAR,CAAa,cAAb,EAA6BG,IAA7B,GAAoCE,OAApC,CAA4C,UAA5C,EAAwD,EAAxD,EAA4DA,OAA5D,EAAxB;AACAH,iBAAK,UAAL,IAAoBL,EAAE,IAAF,EAAQG,IAAR,CAAa,WAAb,EAA0BM,MAA1B,IAAoC,CAArC,GAA0C,IAA1C,GAAiD,IAApE;;AAEA,gBAAIC,YAAYZ,QAAQa,GAAR,CAAY,cAAZ,CAAhB;AACA,gBAAIC,QAAQF,UAAU,MAAV,CAAZ;AACA,gBAAG,CAACE,KAAJ,EAAW;AACPA,wBAAQ,EAAR;AACH;AACDA,kBAAMC,IAAN,CAAWR,IAAX;AACAK,sBAAU,MAAV,IAAoBE,KAApB;AACAd,oBAAQgB,GAAR,CAAY,cAAZ,EAA4BJ,SAA5B;AACAK,gBAAI,YAAYC,KAAKC,SAAL,CAAeZ,IAAf,CAAhB;AACH,SAjBD;AAkBH;;AAED,aAASa,aAAT,CAAuBC,IAAvB,EAA6BC,KAA7B,EAAoC;AAChCL,YAAI,UAAUK,KAAV,GAAkB,UAAtB;AACA;AACA,YAAIC,eAAe,EAAnB;AACAA,qBAAa,UAAb,IAA2BF,OAAO,EAAP,GAAYC,KAAvC;AACAC,qBAAa,KAAb,IAAsBC,SAAS,IAAIC,IAAJ,GAAWC,OAAX,KAAqB,IAA9B,EAAoCC,QAApC,EAAtB;AACA3B,gBAAQgB,GAAR,CAAY,cAAZ,EAA4BO,YAA5B;AACArB,UAAE0B,IAAF,CAAO;AACHC,iBAAK,kDADF;AAEHC,kBAAM,MAFH;AAGHvB,kBAAM,OAAO,IAAIkB,IAAJ,GAAWC,OAAX,EAAP,GAA8B,QAA9B,GAAyCL,IAAzC,GAAgD,MAAhD,GAAyDC,KAAzD,GAAiE,qCAHpE;AAIH;AACA;AACA;AACAS,qBAAS,iBAAS3B,GAAT,EAAc;AACnBa,oBAAI,OAAOK,KAAP,GAAe,YAAnB;AACAnB,0BAAUC,GAAV;AACAF,kBAAE,UAAF,EAAc8B,IAAd,CAAmB5B,GAAnB;AACA;AACA,oBAAIG,OAAOP,QAAQa,GAAR,CAAY,cAAZ,CAAX;AACAN,qBAAK,YAAL,IAAqB0B,OAAOC,QAA5B;AACA3B,qBAAK,QAAL,IAAiB,CAAjB;AACAP,wBAAQgB,GAAR,CAAY,cAAZ,EAA4BT,IAA5B;;AAEA;AACA,oBAAI0B,OAAOE,MAAP,GAAgBF,OAAOC,QAA3B,EAAqC;AACjCE;AACH,iBAFD,MAEO;AACH,wBAAIC,OAAOrC,QAAQa,GAAR,CAAY,MAAZ,CAAX;AACA,wBAAG,CAACwB,KAAK,cAAL,CAAJ,EAA0B;AACtBA,6BAAK,cAAL,IAAuB,EAAvB;AACH;AACDA,yBAAK,cAAL,EAAqBtB,IAArB,CAA0BR,IAA1B;AACAP,4BAAQgB,GAAR,CAAY,MAAZ,EAAoBqB,IAApB;AACArC,4BAAQgB,GAAR,CAAY,cAAZ,EAA4B,EAA5B;AACAC,wBAAI,cAAcC,KAAKC,SAAL,CAAeZ,IAAf,CAAlB;AACA+B;AACH;AACJ,aA/BE;AAgCHC,mBAAO,eAASC,GAAT,EAAcpC,GAAd,EAAkB;AACrB;AACA,oBAAIG,OAAOP,QAAQa,GAAR,CAAY,cAAZ,CAAX;AACAN,qBAAK,YAAL,IAAqB,CAArB;AACAA,qBAAK,QAAL,IAAiB,CAAjB;AACAA,qBAAK,MAAL,IAAe,EAAf;AACA,oBAAI8B,OAAOrC,QAAQa,GAAR,CAAY,MAAZ,CAAX;AACA,oBAAG,CAACwB,KAAK,cAAL,CAAJ,EAA0B;AACtBA,yBAAK,cAAL,IAAuB,EAAvB;AACH;AACDA,qBAAK,cAAL,EAAqBtB,IAArB,CAA0BR,IAA1B;AACAP,wBAAQgB,GAAR,CAAY,MAAZ,EAAoBqB,IAApB;AACArC,wBAAQgB,GAAR,CAAY,cAAZ,EAA4B,EAA5B;;AAEAC,oBAAI,QAAQK,KAAR,GAAgB,YAApB;AACAgB;AACH;AAhDE,SAAP;AAkDH;;AAED,aAASF,QAAT,GAAoB;AAChBnB,YAAI,SAAJ;AACA,YAAIwB,QAAQvC,EAAE,IAAF,CAAZ;AACA,YAAIwC,WAAWT,OAAOE,MAAtB;AACAF,eAAOE,MAAP,GAAgBF,OAAOS,QAAP,GAAkBT,OAAOU,MAAzC;AACA,YAAIV,OAAOE,MAAP,GAAgBF,OAAOC,QAA3B,EAAqC;AACjCD,mBAAOE,MAAP,GAAgBF,OAAOC,QAAvB;AACH;AACDO,cAAMT,IAAN,CAAW,iGAAX;AACA,YAAIY,OAAO,oEAAoEX,OAAOY,SAAP,EAA/E;AACA,YAAIC,SAAS,eAAeJ,QAAf,GAA0B,UAA1B,GAAuCT,OAAOE,MAA9C,GAAuD,WAAvD,IAAsEF,OAAOc,OAAP,GAAiB,CAAvF,CAAb;AACA7C,UAAE,gBAAgB+B,OAAOc,OAAzB,EAAkCC,IAAlC,CAAuCJ,OAAOE,MAA9C,EAAsD,UAAS1C,GAAT,EAAc;AAChED,sBAAUC,GAAV;AACA,gBAAIiC,OAAOrC,QAAQa,GAAR,CAAY,MAAZ,CAAX;AACA,gBAAG,CAACwB,KAAK,cAAL,CAAJ,EAA0B;AACtBA,qBAAK,cAAL,IAAuB,EAAvB;AACH;AACDA,iBAAK,cAAL,EAAqBtB,IAArB,CAA0Bf,QAAQa,GAAR,CAAY,cAAZ,CAA1B;AACAb,oBAAQgB,GAAR,CAAY,MAAZ,EAAoBqB,IAApB;AACArC,oBAAQgB,GAAR,CAAY,cAAZ,EAA4B,EAA5B;AACA;AACAsB;AACH,SAXD;AAYH;;AAED,aAASA,KAAT,GAAiB;AACb,YAAIW,WAAWjD,QAAQa,GAAR,CAAY,QAAZ,CAAf;AACA,YAAIoC,YAAYA,SAAStC,MAAT,GAAkB,CAAlC,EAAqC;AACjCX,oBAAQkD,WAAR,CAAoBlD,QAAQa,GAAR,CAAY,KAAZ,IAAqBoC,SAAStC,MAA9B,GAAuC,CAA3D;AACA,gBAAIwC,WAAWF,SAASG,KAAT,EAAf;AACApD,oBAAQgB,GAAR,CAAY,QAAZ,EAAsBiC,QAAtB;AACA7B,0BAAc+B,SAAS9B,IAAvB,EAA6B8B,SAAS7B,KAAtC;AACH,SALD,MAKO;AACH,gBAAIe,OAAOrC,QAAQa,GAAR,CAAY,MAAZ,CAAX;AACAI,gBAAI,uBAAuBC,KAAKC,SAAL,CAAekB,IAAf,CAA3B;AACA;AACAJ,mBAAOoB,QAAP,CAAgBT,IAAhB,GAAuB,gDAAvB;AACH;AACJ;;AAED,aAASU,QAAT,CAAkBjB,IAAlB,EAAwB;AACpBpB,YAAI,mBAAmBC,KAAKC,SAAL,CAAekB,IAAf,CAAvB;AACArC,gBAAQuD,MAAR,CAAerC,KAAKC,SAAL,CAAekB,IAAf,CAAf;AACArC,gBAAQkD,WAAR,CAAoBlD,QAAQa,GAAR,CAAY,KAAZ,IAAqB,CAAzC;AACAb,gBAAQwD,MAAR;AACAxD,gBAAQyD,YAAR,CAAqB,KAArB;AACH;;AAED,QAAGxB,OAAOoB,QAAP,CAAgBT,IAAhB,CAAqBc,OAArB,CAA6B,gCAA7B,KAAkE,CAAC,CAAtE,EAAyE;AACrE,YAAIC,SAASzD,EAAE,kBAAF,CAAb;AACA,YAAIyD,MAAJ,EAAY;AACRA,mBAAOC,GAAP,CAAW,YAAX,EAAyB,QAAzB;AACH;AACD,YAAIC,SAAS3D,EAAE,YAAF,CAAb;AACA,YAAG2D,MAAH,EAAW;AACPA,mBAAOD,GAAP,CAAW,SAAX,EAAsB,MAAtB;AACH;AACD,YAAIE,WAAW5D,EAAE,qBAAF,CAAf;AACA,YAAG4D,QAAH,EAAa;AACTA,qBAASF,GAAT,CAAa,YAAb,EAA2B,QAA3B;AACH;AACD,YAAIG,WAAW7D,EAAE,gBAAF,CAAf;AACA,YAAG6D,QAAH,EAAa;AACTA,qBAASC,KAAT,CAAe,YAAU;AACrB,oBAAIC,aAAa/D,EAAE,sBAAF,CAAjB;AACA,oBAAG+D,UAAH,EAAe;AACX,wBAAIC,WAAWD,WAAWE,GAAX,EAAf;AACAnE,4BAAQoE,QAAR,CAAiB,UAAjB,EAA6BF,QAA7B;AACH;AACD,oBAAIG,YAAYnE,EAAE,qBAAF,CAAhB;AACA,oBAAGmE,SAAH,EAAc;AACV,wBAAIC,OAAOD,UAAUF,GAAV,EAAX;AACAnE,4BAAQoE,QAAR,CAAiB,UAAjB,EAA6BE,IAA7B;AACH;AACJ,aAXD;AAYH;;AAEDpE,UAAE,sBAAF,EAA0BiE,GAA1B,CAA8BnE,QAAQuE,QAAR,CAAiB,UAAjB,CAA9B;AACArE,UAAE,qBAAF,EAAyBiE,GAAzB,CAA6BnE,QAAQuE,QAAR,CAAiB,UAAjB,CAA7B;;AAEAvE,gBAAQwE,WAAR;AACAxE,gBAAQyD,YAAR,CAAqB,KAArB;AACH,KAAC,IAAGxB,OAAOoB,QAAP,CAAgBT,IAAhB,CAAqBc,OAArB,CAA6B,+BAA7B,KAAiE,CAAC,CAArE,EAAuE;AACrE;AACA1D,gBAAQyD,YAAR;;AAEA;AACA,YAAIgB,QAAJ,EAAcC,OAAd;;AAEA,YAAIC,KAAKzE,EAAE,aAAF,CAAT;AACA,YAAIyE,EAAJ,EAAQ;AACJ,gBAAIA,GAAGC,GAAH,CAAO,IAAP,CAAJ,EAAkB;AACd,oBAAIC,KAAKF,GAAGtE,IAAH,CAAQ,iBAAR,CAAT;AACA,oBAAIiB,QAAQuD,GAAGxE,IAAH,CAAQ,SAAR,EAAmBG,IAAnB,EAAZ;AACAc,wBAAQA,MAAMZ,OAAN,CAAc,GAAd,EAAmB,EAAnB,CAAR;AACAY,wBAAQA,MAAMwD,IAAN,EAAR;AACA,oBAAI;AACAL,+BAAWjD,SAASF,KAAT,CAAX;AACH,iBAFD,CAEE,OAAOyD,CAAP,EAAU;AACR9D,wBAAI,WAAJ;AACH;AACD,oBAAII,OAAOwD,GAAGxE,IAAH,CAAQ,SAAR,EAAmBG,IAAnB,EAAX;AACAa,uBAAOA,KAAKyD,IAAL,EAAP;AACA,oBAAI;AACAJ,8BAAUlD,SAASH,IAAT,CAAV;AACH,iBAFD,CAEE,OAAO0D,CAAP,EAAU;AACR9D,wBAAI,UAAJ;AACH;AACJ;AACJ;AACD;AACA,YAAG,CAACwD,QAAD,IAAa,CAACC,OAAjB,EAA0B;AACtB,gBAAIM,OAAO,IAAIvD,IAAJ,EAAX;AACAgD,uBAAWO,KAAKC,QAAL,KAAkB,CAA7B;AACAP,sBAAUM,KAAKE,WAAL,EAAV;AACAjE,gBAAI,sBAAJ;AACH;AACD,YAAIgC,WAAW,EAAf;AACA,YAAIkC,MAAM,CAAV;AACA,YAAIV,YAAYC,OAAhB,EAAyB;AACrB,iBAAK,IAAIU,IAAI,CAAb,EAAgBA,IAAI,CAApB,EAAuBA,GAAvB,EAA4B;AACxB,oBAAI9D,QAAQmD,WAAWW,CAAvB;AACA,oBAAI/D,OAAOqD,OAAX;AACA,oBAAIpD,QAAQ,CAAZ,EAAe;AACXA,6BAAS,EAAT;AACAD,4BAAQ,CAAR;AACH;AACD,oBAAIC,QAAQ,EAAZ,EAAgB;AACZA,4BAAQ,MAAMA,KAAd;AACH;AACD2B,yBAASlC,IAAT,CAAc,EAAE,QAAQM,IAAV,EAAgB,SAASC,KAAzB,EAAd;AACH;AACD6D,kBAAMlC,SAAStC,MAAT,GAAkB,CAAxB;AACAM,gBAAI,cAAcC,KAAKC,SAAL,CAAe8B,QAAf,CAAlB;AACH,SAfD,MAeO;AACHhC,gBAAI,gBAAJ;AACH;AACD;AACAjB,gBAAQgB,GAAR,CAAY,QAAZ,EAAsBiC,QAAtB;AACAjD,gBAAQgB,GAAR,CAAY,KAAZ,EAAmBmE,GAAnB;AACAnF,gBAAQqF,cAAR,CAAuBF,GAAvB;AACA,YAAI9C,OAAOrC,QAAQa,GAAR,CAAY,MAAZ,CAAX;AACA,YAAI,CAACwB,IAAL,EAAW;AACPrC,oBAAQgB,GAAR,CAAY,MAAZ,EAAoB,EAApB;AACH;;AAEDsB;AACH,KAjEC,MAiEK,IAAGL,OAAOoB,QAAP,CAAgBT,IAAhB,CAAqBc,OAArB,CAA6B,2BAA7B,KAA6D,CAAC,CAAjE,EAAmE;AAAC;AACvE,YAAI4B,UAAU,EAAd;AACApF,UAAE,6BAAF,EAAiCG,IAAjC,CAAsC,IAAtC,EAA4CC,IAA5C,CAAiD,YAAU;AACvD,gBAAGJ,EAAE,IAAF,EAAQ8B,IAAR,GAAe0B,OAAf,CAAuB,MAAvB,KAAkC,CAAC,CAAtC,EAAyC;AACrC4B,0BAAUpF,EAAE,IAAF,CAAV;AACA;AACH;AACJ,SALD;AAMA,YAAGoF,OAAH,EAAY;AACR;AACArD,mBAAOoB,QAAP,CAAgBT,IAAhB,GAAuB0C,QAAQC,IAAR,CAAa,MAAb,CAAvB;AACH,SAHD,MAGO;AACHtE,gBAAI,eAAJ;AACA,gBAAIoB,OAAOrC,QAAQa,GAAR,CAAY,MAAZ,CAAX;AACAwB,iBAAK,WAAL,IAAoB,EAApB;AACAiB,qBAASjB,IAAT;AACH;AACJ,KAjBM,MAiBA,IAAGJ,OAAOoB,QAAP,CAAgBT,IAAhB,CAAqBc,OAArB,CAA6B,oCAA7B,KAAqE,CAAC,CAAzE,EAA6E;AAAC;AACjFzC,YAAI,oBAAJ;AACA,YAAIuE,WAAW,EAAf;AACA,YAAI;AACAA,qBAAS,QAAT,IAAqBtF,EAAE,kBAAF,EAAsBG,IAAtB,CAA2B,SAA3B,EAAsC2B,IAAtC,GAA6CtB,OAA7C,CAAqD,UAArD,EAAiE,EAAjE,EAAqEA,OAArE,EAArB;AACH,SAFD,CAEE,OAAOqE,CAAP,EAAU,CACX;AACD,YAAG;AACCS,qBAAS,MAAT,IAAmBtF,EAAE,mBAAF,EAAuBG,IAAvB,CAA4B,UAA5B,EAAwCA,IAAxC,CAA6C,YAA7C,EAA2D2B,IAA3D,GAAkEtB,OAAlE,CAA0E,UAA1E,EAAsF,EAAtF,EAA0FA,OAA1F,EAAnB;AACH,SAFD,CAEE,OAAOqE,CAAP,EAAU,CACX;AACD,YAAG;AACCS,qBAAS,QAAT,IAAqBtF,EAAE,mBAAF,EAAuBG,IAAvB,CAA4B,UAA5B,EAAwCA,IAAxC,CAA6C,YAA7C,EAA2D2B,IAA3D,GAAkEtB,OAAlE,CAA0E,UAA1E,EAAsF,EAAtF,EAA0FA,OAA1F,EAArB;AACH,SAFD,CAEE,OAAOqE,CAAP,EAAU,CACX;AACD,YAAG;AACCS,qBAAS,mBAAT,IAAgCtF,EAAE,0BAAF,EAA8BG,IAA9B,CAAmC,SAAnC,EAA8CA,IAA9C,CAAmD,YAAnD,EAAiEG,IAAjE,GAAwEE,OAAxE,CAAgF,UAAhF,EAA4F,EAA5F,EAAgGA,OAAhG,EAAhC;AACH,SAFD,CAEE,OAAOqE,CAAP,EAAU,CACX;AACD,YAAG;AACCS,qBAAS,WAAT,IAAwBtF,EAAE,0BAAF,EAA8BG,IAA9B,CAAmC,SAAnC,EAA8CA,IAA9C,CAAmD,YAAnD,EAAiEG,IAAjE,GAAwEE,OAAxE,CAAgF,UAAhF,EAA4F,EAA5F,EAAgGA,OAAhG,EAAxB;AACH,SAFD,CAEE,OAAOqE,CAAP,EAAU,CACX;AACD,YAAG;AACCS,qBAAS,mBAAT,IAAgCtF,EAAE,0BAAF,EAA8BG,IAA9B,CAAmC,UAAnC,EAA+CA,IAA/C,CAAoD,YAApD,EAAkEG,IAAlE,GAAyEE,OAAzE,CAAiF,UAAjF,EAA6F,EAA7F,EAAiGA,OAAjG,EAAhC;AACH,SAFD,CAEE,OAAOqE,CAAP,EAAU,CACX;AACD9D,YAAI,kBAAkBC,KAAKC,SAAL,CAAeqE,QAAf,CAAtB;AACA,YAAInD,OAAOrC,QAAQa,GAAR,CAAY,MAAZ,CAAX;AACAwB,aAAK,WAAL,IAAoBmD,QAApB;AACA,YAAInD,KAAK,cAAL,CAAJ,EAA0B;AACtB,gBAAIoD,MAAMpD,KAAK,cAAL,EAAqB1B,MAA/B;AACA,gBAAI8E,MAAM,CAAV,EAAa;AACT,qBAAI,IAAIL,IAAI,CAAZ,EAAeA,IAAIK,GAAnB,EAAwBL,GAAxB,EAA8B;AAC1B/C,yBAAK,cAAL,EAAqB+C,CAArB,EAAwB,QAAxB,IAAoCI,SAAS,QAAT,CAApC;AACH;AACJ;AACJ;AACDlC,iBAASjB,IAAT;AACH;AACJ,CA9RD","file":"../unicom.js","sourcesContent":["dSpider(\"unicom\", 60*5, function(session,env,$){\n\n    function parseThxd(msg) {\n        $(msg).find(\"tr.tips_dial\").each(function() {\n            var data = {}\n            data[\"otherNo\"] = $(this).find(\"label.telphone\").text();\n            data[\"callTime\"] = $(this).find(\"td:eq(1) p\").first().text();\n            data[\"callFee\"] = $(this).find(\"p.time:eq(0)\").text().replace(/[\\n|\\s]/g, \"\").replace();\n            data[\"callBeginTime\"] = $(this).find(\"p.time:eq(1)\").text().replace(/[\\n|\\s]/g, \"\").replace();\n            data[\"callType\"] = ($(this).find(\".call_out\").length == 1) ? \"主叫\" : \"被叫\";\n\n            var monthData = session.get(\"curMonthData\");\n            var datas = monthData[\"data\"];\n            if(!datas) {\n                datas = [];\n            }\n            datas.push(data);\n            monthData[\"data\"] = datas;\n            session.set(\"curMonthData\", monthData);\n            log(\"获取一条数据：\" + JSON.stringify(data));\n        })\n    }\n\n    function getThxdByAjax(year, month) {\n        log(\"开始爬取【\" + month + \"】月份通话详单：\");\n        //session.upload(\"开始爬取【\" + month + \"】月份通话详单：\")\n        var curMonthData = {};\n        curMonthData[\"calldate\"] = year + \"\" + month;\n        curMonthData[\"cid\"] = parseInt(new Date().getTime()/1000).toString();\n        session.set(\"curMonthData\", curMonthData);\n        $.ajax({\n            url: '/mobileService/query/getPhoneByDetailContent.htm',\n            type: 'post',\n            data: 't=' + new Date().getTime() + '&YYYY=' + year + '&MM=' + month + '&DD=&queryMonthAndDay=month&menuId=',\n            //dataType: 'html',\n            //async: true,\n            //cache: false,\n            success: function(msg) {\n                log(\"请求\" + month + \"月份数据成功....\");\n                parseThxd(msg);\n                $('#pageNew').html(msg);\n                //保存数据\n                var data = session.get(\"curMonthData\");\n                data[\"totalCount\"] = window.totalrow;\n                data[\"status\"] = 4;\n                session.set(\"curMonthData\", data);\n\n                //是否需要加载更多\n                if (window.endrow < window.totalrow) {\n                    loadMore();\n                } else {\n                    var thxd = session.get(\"thxd\");\n                    if(!thxd[\"month_status\"]) {\n                        thxd[\"month_status\"] = [];\n                    }\n                    thxd[\"month_status\"].push(data);\n                    session.set(\"thxd\", thxd);\n                    session.set(\"curMonthData\", \"\");\n                    log(\"爬取数据完成...\" + JSON.stringify(data));\n                    spide();\n                }\n            },\n            error: function(xhr, msg){\n                //保存数据\n                var data = session.get(\"curMonthData\");\n                data[\"totalCount\"] = 0;\n                data[\"status\"] = 2;\n                data[\"data\"] = [];\n                var thxd = session.get(\"thxd\");\n                if(!thxd[\"month_status\"]) {\n                    thxd[\"month_status\"] = [];\n                }\n                thxd[\"month_status\"].push(data);\n                session.set(\"thxd\", thxd);\n                session.set(\"curMonthData\", \"\");\n\n                log(\"爬取【\" + month + \"】月份通话详单失败！\");\n                spide();\n            }\n        });\n    }\n\n    function loadMore() {\n        log(\"加载更多...\")\n        var _this = $(this);\n        var beginrow = window.endrow;\n        window.endrow = window.beginrow + window.perrow;\n        if (window.endrow > window.totalrow) {\n            window.endrow = window.totalrow;\n        }\n        _this.html('<img src=\"http://img.client.10010.com/mobileService/view/client/images/loading.gif\" width=\"16\">');\n        var href = '/mobileService/view/client/query/xdcx/thxd_more_list.jsp?1=1&t=' + window.getrandom();\n        var params = '&beginrow=' + beginrow + '&endrow=' + window.endrow + '&pagenum=' + (window.pagenum + 1);\n        $('.moredetail' + window.pagenum).load(href + params, function(msg) {\n            parseThxd(msg);\n            var thxd = session.get(\"thxd\");\n            if(!thxd[\"month_status\"]) {\n                thxd[\"month_status\"] = [];\n            }\n            thxd[\"month_status\"].push(session.get(\"curMonthData\"));\n            session.set(\"thxd\", thxd);\n            session.set(\"curMonthData\", \"\");\n            //继续爬取\n            spide();\n        });\n    }\n\n    function spide() {\n        var monthArr = session.get(\"months\");\n        if (monthArr && monthArr.length > 0) {\n            session.setProgress(session.get(\"max\") - monthArr.length - 1);\n            var monthObj = monthArr.shift();\n            session.set(\"months\", monthArr);\n            getThxdByAjax(monthObj.year, monthObj.month);\n        } else {\n            var thxd = session.get(\"thxd\");\n            log(\"爬取通话详单完毕----------\" + JSON.stringify(thxd));\n            //跳转到服务首页\n            window.location.href = \"http://wap.10010.com/mobileService/siteMap.htm\";\n        }\n    }\n\n    function endSpide(thxd) {\n        log(\"爬取完毕----------\" + JSON.stringify(thxd));\n        session.upload(JSON.stringify(thxd));\n        session.setProgress(session.get(\"max\") - 0);\n        session.finish();\n        session.showProgress(false);\n    }\n\n    if(window.location.href.indexOf(\"/uac.10010.com/oauth2/new_auth\") != -1) {\n        var footer = $(\"div.footer:eq(0)\");\n        if (footer) {\n            footer.css(\"visibility\", \"hidden\");\n        }\n        var header = $(\"div.header\");\n        if(header) {\n            header.css(\"display\", \"none\");\n        }\n        var passFind = $(\"div.interval2:eq(0)\");\n        if(passFind) {\n            passFind.css(\"visibility\", \"hidden\");\n        }\n        var loginBtn = $(\"a#login1:eq(0)\");\n        if(loginBtn) {\n            loginBtn.click(function(){\n                var unameInput = $(\"input#userName:eq(0)\");\n                if(unameInput) {\n                    var userName = unameInput.val();\n                    session.setLocal(\"userName\", userName);\n                }\n                var passInput = $(\"input#userPwd:eq(0)\");\n                if(passInput) {\n                    var pass = passInput.val();\n                    session.setLocal(\"password\", pass);\n                }\n            });\n        }\n\n        $(\"input#userName:eq(0)\").val(session.getLocal(\"userName\"));\n        $(\"input#userPwd:eq(0)\").val(session.getLocal(\"password\"));\n\n        session.setStartUrl();\n        session.showProgress(false);\n    } if(window.location.href.indexOf('query/getPhoneByDetailTip.htm') != -1){\n        //显示loading\n        session.showProgress();\n\n        //计算月份信息\n        var curMonth, curYear;\n\n        var ul = $(\".month_list\");\n        if (ul) {\n            if (ul.has(\"li\")) {\n                var li = ul.find(\"li.active:eq(0)\");\n                var month = li.find(\"p:eq(0)\").text();\n                month = month.replace(\"月\", \"\");\n                month = month.trim();\n                try {\n                    curMonth = parseInt(month);\n                } catch (e) {\n                    log(\"月份获取失败...\");\n                }\n                var year = li.find(\"p:eq(1)\").text();\n                year = year.trim();\n                try {\n                    curYear = parseInt(year);\n                } catch (e) {\n                    log(\"年获取失败...\");\n                }\n            };\n        };\n        //若获取时间失败，则使用当前时间\n        if(!curMonth || !curYear) {\n            var date = new Date();\n            curMonth = date.getMonth() + 1;\n            curYear = date.getFullYear();\n            log(\"获取网页时间失败，获取当前系统时间...\");\n        }\n        var monthArr = []\n        var max = 0;\n        if (curMonth && curYear) {\n            for (var i = 0; i < 6; i++) {\n                var month = curMonth - i;\n                var year = curYear;\n                if (month < 1) {\n                    month += 12;\n                    year -= 1;\n                }\n                if (month < 10) {\n                    month = \"0\" + month;\n                }\n                monthArr.push({ \"year\": year, \"month\": month });\n            }\n            max = monthArr.length + 1;\n            log(\"开始爬取.....\" + JSON.stringify(monthArr));\n        } else {\n            log(\"没有通话时间，可能刚开卡..\");\n        }\n        //设置月份信息\n        session.set(\"months\", monthArr);\n        session.set(\"max\", max);\n        session.setProgressMax(max);\n        var thxd = session.get(\"thxd\");\n        if (!thxd) {\n            session.set(\"thxd\", {});\n        };\n\n        spide();\n    } else if(window.location.href.indexOf('mobileService/siteMap.htm') != -1){//服务界面，获取个人信息跳转\n        var infoTag = \"\";\n        $(\".checklistcontainer.newmore\").find(\"li\").each(function(){\n            if($(this).html().indexOf(\"基本信息\") != -1) {\n                infoTag = $(this);\n                return;\n            }\n        });\n        if(infoTag) {\n            //跳转到我的基本信息页面\n            window.location.href = infoTag.attr(\"name\");\n        } else {\n            log(\"用户信息获取失败.....\");\n            var thxd = session.get(\"thxd\");\n            thxd[\"user_info\"] = {};\n            endSpide(thxd);\n        }\n    } else if(window.location.href.indexOf(\"t/operationservice/getUserinfo.htm\") !=-1 ) {//获取个人信息\n        log(\"开始爬取用户信息----------\");\n        var userInfo = {};\n        try {\n            userInfo[\"mobile\"] = $(\".clientInfo4_top\").find(\"p:eq(0)\").html().replace(/[\\n|\\s]/g, \"\").replace();\n        } catch (e) {\n        }\n        try{\n            userInfo[\"name\"] = $(\".clientInfo4_list\").find(\"li:eq(0)\").find(\"span:eq(1)\").html().replace(/[\\n|\\s]/g, \"\").replace();\n        } catch (e) {\n        }\n        try{\n            userInfo[\"taocan\"] = $(\".clientInfo4_list\").find(\"li:eq(1)\").find(\"span:eq(1)\").html().replace(/[\\n|\\s]/g, \"\").replace();\n        } catch (e) {\n        }\n        try{\n            userInfo[\"registration_time\"] = $(\".detail_con.con_ft:eq(0)\").find(\"p:eq(6)\").find(\"span:eq(1)\").text().replace(/[\\n|\\s]/g, \"\").replace();\n        } catch (e) {\n        }\n        try{\n            userInfo[\"idcard_no\"] = $(\".detail_con.con_ft:eq(1)\").find(\"p:eq(4)\").find(\"span:eq(1)\").text().replace(/[\\n|\\s]/g, \"\").replace();\n        } catch (e) {\n        }\n        try{\n            userInfo[\"household_address\"] = $(\".detail_con.con_ft:eq(1)\").find(\"p:eq(18)\").find(\"span:eq(1)\").text().replace(/[\\n|\\s]/g, \"\").replace();\n        } catch (e) {\n        }\n        log(\"爬取用户信息结束-----\" + JSON.stringify(userInfo));\n        var thxd = session.get(\"thxd\");\n        thxd[\"user_info\"] = userInfo;\n        if (thxd[\"month_status\"]) {\n            var len = thxd[\"month_status\"].length;\n            if (len > 0) {\n                for(var i = 0; i < len; i ++) {\n                    thxd[\"month_status\"][i][\"mobile\"] = userInfo[\"mobile\"];\n                }\n            }\n        }\n        endSpide(thxd);\n    }\n})"]}