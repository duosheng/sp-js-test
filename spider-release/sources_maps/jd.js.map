{"version":3,"sources":["jd.js"],"names":["dSpider","session","env","$","re","infokey","sid","max_order_num","max_order_date","globalInfo","get","location","href","indexOf","showProgress","setProgressMax","autoLoadImg","setProgress","undefined","children","value","set","info","base_info","username","text","replace","saveInfo","global_contact_info","contact_info","taskAddr","urlarray","i","length","push","response","status","node","append","name","trim","find","phone","addr","innerHTML","detail","contact_detail","contact","when","apply","done","getOrder","orders","order_info","order_detail","getPageOrder","page","getJSON","d","orderList","orderId","concat","task","tempOrder","slice","each","e","log","ajax","type","url","passKeyList","async","success","orderitem","order","dataSubmit","price","products","k","num","product","Date","parse","time","split","getTime","sort","compare","getUserInfo","a","b","value1","value2","click","idcard_no","logout","upload","finish","attr","addrdetail","address","site_id","zipcode","id","total","number","setStartUrl"],"mappings":"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","file":"../jd.js","sourcesContent":["\ndSpider(\"jd\", function(session,env,$){\n\n    var re = /sid=(.+)$/ig;\n    var infokey = \"infokey\";\n    var sid = \"\";\n    var max_order_num = 30;\n    var max_order_date = 1000;\n    var globalInfo;\n\n    sid = session.get(\"sid\");\n\n    if (location.href.indexOf(\"://m.jd.com\") != -1 ) {\n        session.showProgress(true);\n        session.setProgressMax(100);\n        session.autoLoadImg(false);\n        session.setProgress(5);\n\n        if($(\".jd-search-form-input\")[0] != undefined){\n            sid  = $(\".jd-search-form-input\")[0].children[0].value;\n            session.set(\"sid\",  sid);\n         }\n\n        session.set(infokey, new info({},{},{}));\n        globalInfo = session.get(infokey);\n        globalInfo.base_info.username  = $(\"[report-eventid$='MCommonHTail_Account']\").text().replace(/\\n/g,\"\").replace(/\\t/g,\"\");\n        saveInfo();\n        session.setProgress(10);\n        location.href=\"http://home.m.jd.com/maddress/address.action?\";\n    }\n\n    if (location.href.indexOf(\"://home.m.jd.com/maddress\") != -1) {\n        session.setProgress(20);\n\n        globalInfo = session.get(infokey);\n\n        global_contact_info = new contact_info([]);\n        var taskAddr = [];\n        var urlarray = $(\".ia-r\");\n        for(var i=0;i<urlarray.length;i++){\n                                    taskAddr.push($.get(urlarray[i],function(response,status){\n                                    var node = $(\"<div>\").append($(response))\n                                    var name = $.trim(node.find(\"#uersNameId\")[0].value);\n                                    var phone = $.trim(node.find(\"#mobilePhoneId\")[0].value);\n                                    var addr = $.trim(node.find(\"#addressLabelId\")[0].innerHTML);\n                                    var detail = $.trim(node.find(\"#address_where\")[0].innerHTML);\n\n                                    global_contact_info.contact_detail.push(new contact(name,addr,detail,phone, \"\"));\n                                    }) );\n\n            }\n\n\n          $.when.apply($,taskAddr).done(\n       // $.when(taskAddr).done(\n                  function(){\n                        globalInfo.contact_info = global_contact_info;\n                        saveInfo();\n                        session.setProgress(30);\n                        getOrder();\n                        });\n\n\n    }\n\n\n    function getOrder(){\n        session.setProgress(40);\n        globalInfo = session.get(infokey);\n        var orders = new order_info([]);\n        globalInfo.order_info = new order_info([]);\n        globalInfo.order_info.order_detail = [];\n        function getPageOrder(page){\n           $.getJSON(\"https://home.m.jd.com//newAllOrders/newAllOrders.json?sid=\"+sid+\"&page=\"+page,function(d){\n               page++;\n               if( globalInfo.order_info.order_detail.length <=  max_order_num && d.orderList.length!=0 && (orders.order_detail.length == 0 || d.orderList[d.orderList.length-1].orderId != orders.order_detail[orders.order_detail.length-1].orderId) ){\n                   orders.order_detail = orders.order_detail.concat(d.orderList);\n                   var task = [];\n                   var tempOrder = [];\n                   if(globalInfo.order_info.order_detail.length < max_order_num){\n                        if(d.orderList.length + globalInfo.order_info.order_detail.length > max_order_num){\n                           d.orderList = d.orderList.slice(0, max_order_num -  globalInfo.order_info.order_detail.length);\n                        }\n                        task.push($.each(d.orderList,function(i,e){\n                                            log(\"task push orderId: \" + d.orderList[i].orderId);\n\n//                                           $.get(\"https://home.m.jd.com/newAllOrders/queryOrderDetailInfo.action?orderId=\"+ d.orderList[i].orderId+\"&from=newUserAllOrderList&passKey=\"+d.passKeyList[i]+\"&sid=\"+sid,\n//                                                   function(response,status){\n//                                                        log(\"orderId: \" + d.orderList[i].orderId);\n//                                                        var addr = $(\"<div>\").append($(response)).find(\".step2-in-con\").text();\n//                                                        var orderitem = new order(d.orderList[i].orderId,d.orderList[i].dataSubmit,d.orderList[i].price,addr);\n//\n//                                                        orderitem.products = [];\n//                                                        var products = $(\"<div>\").append($(response)).find(\".pdiv\");\n//                                                        $.each(products,function(k, e){\n//                                                                                                       var name = $(\"<div>\").append(products[k]).find(\".sitem-m-txt\").text();\n//                                                                                                       var price = $(\"<div>\").append(products[k]).find(\".sitem-r\").text();\n//                                                                                                       var num = $(\"<div>\").append(products[k]).find(\".s3-num\").text();\n//                                                                                                       orderitem.products.push(new product(name,  num ,price));\n//                                                         });\n//                                                         if(Date.parse(new Date()) < ((new Date(orderitem.time.split(\" \")[0])).getTime() + max_order_date * 24 * 60 * 60 * 1000)){\n//                                                              if(globalInfo.order_info.order_detail.length < max_order_num){\n//                                                                   globalInfo.order_info.order_detail.push(orderitem);\n//                                                              }\n//                                                            }\n//                                                        });\n                                            $.ajax({\n                                                      type : \"get\",\n                                                      url : \"https://home.m.jd.com/newAllOrders/queryOrderDetailInfo.action?orderId=\"+ d.orderList[i].orderId+\"&from=newUserAllOrderList&passKey=\"+d.passKeyList[i]+\"&sid=\"+sid,\n                                                      async : false,\n                                                      success : function(response){\n                                                        log(\"orderId: \" + d.orderList[i].orderId);\n                                                         var addr = $.trim($(\"<div>\").append($(response)).find(\".step2-in-con\").text());\n                                                         var orderitem = new order(d.orderList[i].orderId,d.orderList[i].dataSubmit,d.orderList[i].price,addr);\n\n                                                         orderitem.products = [];\n                                                         var products = $(\"<div>\").append($(response)).find(\".pdiv\");\n                                                         $.each(products,function(k, e){\n                                                                var name = $.trim($(\"<div>\").append(products[k]).find(\".sitem-m-txt\").text());\n                                                                var price = $.trim($(\"<div>\").append(products[k]).find(\".sitem-r\").text());\n                                                                var num = $.trim($(\"<div>\").append(products[k]).find(\".s3-num\").text());\n                                                                orderitem.products.push(new product(name,  num ,price));\n                                                          });\n                                                          if(Date.parse(new Date()) < ((new Date(orderitem.time.split(\" \")[0])).getTime() + max_order_date * 24 * 60 * 60 * 1000)){\n                                                              if(globalInfo.order_info.order_detail.length < max_order_num){\n                                                                   globalInfo.order_info.order_detail.push(orderitem);\n                                                              }\n                                                          }\n                                                      }\n                                                      });\n                                         }));\n                    }\n\n\n                      $.when(task).done(function(){\n                           log(\"get page :\" + page);\n                           log(\"count: \" +globalInfo.order_info.order_detail.length );\n                           getPageOrder(page);\n                           globalInfo.order_info.order_detail.sort(compare());\n                      });\n\n               }else {\n                  log(\"finish\");\n                  saveInfo();\n                  session.setProgress(60);\n                  getUserInfo();\n                  return;\n               }\n           });\n       }\n       getPageOrder(1);\n    }\n\n    function compare(){\n        return function(a,b){\n            var value1 = (new Date(a.time.split(\" \")[0])).getTime();\n            var value2 = (new Date(b.time.split(\" \")[0])).getTime();\n            return value2 - value1;\n    }\n    }\n\n    function getUserInfo(){\n           location.href = \"http://home.m.jd.com/user/accountCenter.action\";\n    }\n    if (location.href.indexOf(\"://home.m.jd.com/user/accountCenter.action\") != -1 && location.href.indexOf(\"loginpage\") == -1) {\n        session.setProgress(70);\n        if($('#shimingrenzheng')[0] != undefined){\n           $('#shimingrenzheng')[0].click();\n        }\n    }\n\n    //已实名用户\n    if (location.href.indexOf(\"msc.jd.com/auth/loginpage/wcoo/toAuthInfoPage\") != -1) {\n        session.setProgress(90);\n        globalInfo = session.get(infokey);\n        if( $(\".pos-ab\")[0] != undefined){\n            globalInfo.base_info.name  = $(\".pos-ab\")[0].innerHTML;\n        }\n        if($(\".pos-ab\")[1] != undefined){\n            globalInfo.base_info.idcard_no  = $(\".pos-ab\")[1].innerHTML;\n        }\n        saveInfo();\n        logout();\n\n\n    }\n\n    function logout(){\n\n        //alert(\"爬取订单总计:\" + session.get(infokey).order_info.order_detail.length);\n        location.href = \"https://passport.m.jd.com/user/logout.action?sid=\"+session.get(\"sid\");\n        session.setProgress(100);\n        session.upload(session.get(infokey));\n        session.finish();\n    }\n    //快捷卡实名用户\n    if (location.href.indexOf(\"msc.jd.com/auth/loginpage/wcoo/toAuthPage\") != -1 ) {\n        session.setProgress(90);\n        globalInfo = session.get(infokey);\n        if($(\"#username\")[0] !=undefined){\n            globalInfo.base_info.name  = $(\"#username\")[0].innerHTML;\n        }\n        if($(\".info-user-name\")[0] !=undefined){\n                    globalInfo.base_info.name  = $(\".info-user-name\")[0].innerHTML;\n        }\n        if($(\"#idcard\")[0] !=undefined){\n            globalInfo.base_info.idcard_no  = $(\"#idcard\")[0].innerHTML;\n        }\n        if($(\".pos-ab[data-cardno]\") !=undefined){\n                    globalInfo.base_info.idcard_no  = $(\".pos-ab[data-cardno]\").attr(\"data-cardno\");\n        }\n\n        saveInfo();\n        logout();\n    }\n\n    function saveInfo(){\n        session.set(infokey, globalInfo);\n    }\n\n\n\n    function addr(name,phone,addrdetail) {\n        this.name = name;\n        this.phone = phone;\n        this.addrdetail = addrdetail;\n    }\n\n    var address = [];\n    var global_contact_info;\n\n\n    function info(base_info,contact_info,order_info ){\n        this.site_id = 2;\n    　　 this.base_info = base_info;\n    　　 this.contact_info = contact_info;\n    　　 this.order_info  = order_info;\n    }\n\n    function base_info(username, name, idcard_no, phone){\n        this.username = username;\n        this.name = name;\n        this.idcard_no = idcard_no;\n        this.phone = phone;\n    }\n\n\n    function contact_info(contact_detail){\n        this.contact_detail = contact_detail;\n    }\n\n    function contact(name, location ,address, phone, zipcode){\n        this.name  = name;\n        this.location  = location;\n        this.address  = address;\n        this.phone  = phone;\n        this.zipcode  = zipcode;\n    }\n\n    function order_info(order_detail){\n        this.order_detail  = order_detail;\n    }\n\n    function order(id, time , total, address){\n        this.id  = id;\n        this.time  = time;\n        this.total  = total;\n        this.address  = address;\n    }\n\n    function product(name, number, price){\n        this.name  = name;\n        this.number  = number;\n        this.price  = price;\n    }\n\n    // 增加判断当前页面是否是登录页  modify by renxin 2017.1.17\n    if ($(\"#loginOneStep\").length && $(\"#loginOneStep\").length > 0) {\n      session.setStartUrl();\n    }\n\n\n//end\n})"]}