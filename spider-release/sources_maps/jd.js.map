{"version":3,"sources":["jd.js"],"names":["globalInfo","$","getJSON","page","orders","order_detail","length","order_info","d","orderList","orderId","session","getUserInfo","compare","tempOrder","append","slice","max_order_num","products","get","i","passKeyList","sid","response","status","order","text","push","each","find","getTime","max_order_date","price","num","k","orderitem","product","name","Date","getPageOrder","location","a","b","value2","time","split","href","indexOf","value1","upload","finish","infokey","address","set","site_id","contact_info","this","base_info","contact_detail","phone","zipcode","total","id","number","showProgress","setProgressMax","autoLoadImg","undefined","info","saveInfo","setProgress","global_contact_info","urlarray","taskAddr","node","value","addr","trim","innerHTML","when","apply","done","getOrder","click","logout","idcard_no","attr","setStartUrl"],"mappings":"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","file":"../jd.js","sourcesContent":["\ndSpider(\"jd\", 60*5, function(session,env,$){\n\n    var re = /sid=(.+)$/ig;\n    var infokey = \"infokey\";\n    var sid = \"\";\n    var max_order_num = 30;\n    var max_order_date = 100;\n    var globalInfo;\n\n    sid = session.get(\"sid\");\n\n    if (location.href.indexOf(\"://m.jd.com\") != -1 ) {\n        session.showProgress(true);\n        session.setProgressMax(100);\n        session.autoLoadImg(false);\n        session.setProgress(5);\n\n        if($(\".jd-search-form-input\")[0] != undefined){\n            sid  = $(\".jd-search-form-input\")[0].children[0].value;\n            session.set(\"sid\",  sid);\n         }\n\n        session.set(infokey, new info({},{},{}));\n        globalInfo = session.get(infokey);\n        globalInfo.base_info.username  = $(\"[report-eventid$='MCommonHTail_Account']\").text().replace(/\\n/g,\"\").replace(/\\t/g,\"\");\n        saveInfo();\n        session.setProgress(10);\n        location.href=\"http://home.m.jd.com/maddress/address.action?\";\n    }\n\n    if (location.href.indexOf(\"://home.m.jd.com/maddress\") != -1) {\n        session.setProgress(20);\n\n        globalInfo = session.get(infokey);\n\n        global_contact_info = new contact_info([]);\n        var taskAddr = [];\n        var urlarray = $(\".ia-r\");\n        for(var i=0;i<urlarray.length;i++){\n                                    taskAddr.push($.get(urlarray[i],function(response,status){\n                                    var node = $(\"<div>\").append($(response))\n                                    var name = node.find(\"#uersNameId\")[0].value;\n                                    var phone = node.find(\"#mobilePhoneId\")[0].value;\n                                    var addr =$.trim(node.find(\"#addressLabelId\")[0].innerHTML);\n                                    var detail = $.trim(node.find(\"#address_where\")[0].innerHTML);\n\n                                    global_contact_info.contact_detail.push(new contact(name,addr,detail,phone, \"\"));\n                                    }) );\n\n            }\n\n\n          $.when.apply($,taskAddr).done(\n       // $.when(taskAddr).done(\n                  function(){\n                        globalInfo.contact_info = global_contact_info;\n                        saveInfo();\n                        session.setProgress(30);\n                        getOrder();\n                        });\n\n\n    }\n\n\n    function getOrder(){\n        session.setProgress(40);\n        globalInfo = session.get(infokey);\n        var orders = new order_info([]);\n        globalInfo.order_info = new order_info([]);\n        globalInfo.order_info.order_detail = [];\n        function getPageOrder(page){\n           $.getJSON(\"https://home.m.jd.com//newAllOrders/newAllOrders.json?sid=\"+sid+\"&page=\"+page,function(d){\n               page++;\n               if( globalInfo.order_info.order_detail.length <=  max_order_num && d.orderList.length!=0 && (orders.order_detail.length == 0 || d.orderList[d.orderList.length-1].orderId != orders.order_detail[orders.order_detail.length-1].orderId) ){\n                   orders.order_detail = orders.order_detail.concat(d.orderList);\n                   var task = [];\n                   var tempOrder = [];\n                   if(globalInfo.order_info.order_detail.length < max_order_num){\n                        if(d.orderList.length + globalInfo.order_info.order_detail.length > max_order_num){\n                           d.orderList = d.orderList.slice(0, max_order_num -  globalInfo.order_info.order_detail.length);\n                        }\n                        task.push($.each(d.orderList,function(i,e){\n                                           $.get(\"https://home.m.jd.com/newAllOrders/queryOrderDetailInfo.action?orderId=\"+ d.orderList[i].orderId+\"&from=newUserAllOrderList&passKey=\"+d.passKeyList[i]+\"&sid=\"+sid,\n                                                   function(response,status){\n                                                        var addr = $(\"<div>\").append($(response)).find(\".step2-in-con\").text();\n                                                        var orderitem = new order(d.orderList[i].orderId,d.orderList[i].dataSubmit,d.orderList[i].price,addr);\n\n                                                        orderitem.products = [];\n                                                        var products = $(\"<div>\").append($(response)).find(\".pdiv\");\n                                                        $.each(products,function(k, e){\n                                                                                                       var name = $(\"<div>\").append(products[k]).find(\".sitem-m-txt\").text();\n                                                                                                       var price = $(\"<div>\").append(products[k]).find(\".sitem-r\").text();\n                                                                                                       var num = $(\"<div>\").append(products[k]).find(\".s3-num\").text();\n                                                                                                       orderitem.products.push(new product(name,  num ,price));\n                                                         });\n                                                                                                   if(Date.parse(new Date()) < ((new Date(orderitem.time.split(\" \")[0])).getTime() + max_order_date * 24 * 60 * 60 * 1000)){\n                                                                                                           if(globalInfo.order_info.order_detail.length < max_order_num){\n                                                                                                                 globalInfo.order_info.order_detail.push(orderitem);\n                                                                                                           }\n                                                                                                   }\n                                                                                             });\n                                         }));\n                   }\n\n\n                      $.when(task).done(function(){\n                           getPageOrder(page);\n                           globalInfo.order_info.order_detail.sort(compare());\n                      });\n\n               }else {\n                  saveInfo();\n                  session.setProgress(60);\n                  getUserInfo();\n                  return;\n               }\n           });\n       }\n       getPageOrder(1);\n    }\n\n    function compare(){\n        return function(a,b){\n            var value1 = (new Date(a.time.split(\" \")[0])).getTime();\n            var value2 = (new Date(b.time.split(\" \")[0])).getTime();\n            return value2 - value1;\n    }\n    }\n\n    function getUserInfo(){\n           location.href = \"http://home.m.jd.com/user/accountCenter.action\";\n    }\n    if (location.href.indexOf(\"://home.m.jd.com/user/accountCenter.action\") != -1 && location.href.indexOf(\"loginpage\") == -1) {\n        session.setProgress(70);\n        if($('#shimingrenzheng')[0] != undefined){\n           $('#shimingrenzheng')[0].click();\n        }\n    }\n\n    //已实名用户\n    if (location.href.indexOf(\"msc.jd.com/auth/loginpage/wcoo/toAuthInfoPage\") != -1) {\n        session.setProgress(90);\n        globalInfo = session.get(infokey);\n        if( $(\".pos-ab\")[0] != undefined){\n            globalInfo.base_info.name  = $(\".pos-ab\")[0].innerHTML;\n        }\n        if($(\".pos-ab\")[1] != undefined){\n            globalInfo.base_info.idcard_no  = $(\".pos-ab\")[1].innerHTML;\n        }\n        saveInfo();\n        logout();\n\n\n    }\n\n    function logout(){\n\n        //alert(\"爬取订单总计:\" + session.get(infokey).order_info.order_detail.length);\n        //location.href = \"https://passport.m.jd.com/user/logout.action?sid=\"+session.get(\"sid\");\n        session.setProgress(100);\n        session.upload(session.get(infokey));\n        session.finish();\n    }\n    //快捷卡实名用户\n    if (location.href.indexOf(\"msc.jd.com/auth/loginpage/wcoo/toAuthPage\") != -1 ) {\n        session.setProgress(90);\n        globalInfo = session.get(infokey);\n        if($(\"#username\")[0] !=undefined){\n            globalInfo.base_info.name  = $(\"#username\")[0].innerHTML;\n        }\n        if($(\".info-user-name\")[0] !=undefined){\n                    globalInfo.base_info.name  = $(\".info-user-name\")[0].innerHTML;\n        }\n        if($(\"#idcard\")[0] !=undefined){\n            globalInfo.base_info.idcard_no  = $(\"#idcard\")[0].innerHTML;\n        }\n        if($(\".pos-ab[data-cardno]\") !=undefined){\n                    globalInfo.base_info.idcard_no  = $(\".pos-ab[data-cardno]\").attr(\"data-cardno\");\n        }\n\n        saveInfo();\n        logout();\n    }\n\n    function saveInfo(){\n        session.set(infokey, globalInfo);\n    }\n\n\n\n    function addr(name,phone,addrdetail) {\n        this.name = name;\n        this.phone = phone;\n        this.addrdetail = addrdetail;\n    }\n\n    var address = [];\n    var global_contact_info;\n\n\n    function info(base_info,contact_info,order_info ){\n        this.site_id = 2;\n    　　 this.base_info = base_info;\n    　　 this.contact_info = contact_info;\n    　　 this.order_info  = order_info;\n    }\n\n    function base_info(username, name, idcard_no, phone){\n        this.username = username;\n        this.name = name;\n        this.idcard_no = idcard_no;\n        this.phone = phone;\n    }\n\n\n    function contact_info(contact_detail){\n        this.contact_detail = contact_detail;\n    }\n\n    function contact(name, location ,address, phone, zipcode){\n        this.name  = name;\n        this.location  = location;\n        this.address  = address;\n        this.phone  = phone;\n        this.zipcode  = zipcode;\n    }\n\n    function order_info(order_detail){\n        this.order_detail  = order_detail;\n    }\n\n    function order(id, time , total, address){\n        this.id  = id;\n        this.time  = time;\n        this.total  = total;\n        this.address  = address;\n    }\n\n    function product(name, number, price){\n        this.name  = name;\n        this.number  = number;\n        this.price  = price;\n    }\n\n// 增加判断当前页面是否是登录页  modify by renxin 2017.1.17\nif ($(\"#loginOneStep\").length && $(\"#loginOneStep\").length > 0) {       \n  session.setStartUrl();\n}\n//end\n})\n"]}