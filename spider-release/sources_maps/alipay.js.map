{"version":3,"sources":["alipay.js"],"names":["dSpider","session","env","$","log","location","href","userInfoKey","monthArray","uploadMonArray","monCount","sumCount","now","Date","length","setStartUrl","window","indexOf","showProgress","hideElement","getLocal","undefined","val","onclick","setLocal","setProgressMax","setProgress","delay","setTimeout","fetchUserInfo","jumptoBankPage","fetchBankList","switchVersion","spideOrder","endDate","formateDate","setMonth","getMonth","beginDate","fetchOrderListBy","pageNum","daterange","beginTime","endTime","ajax","url","type","data","dataType","async","cache","success","res","find","concat","begin_date","end_date","begin_time","end_time","uploadData","order_info","upload","finish","offset","map","index","name","formateStr","text","time","amount","tradeNo","i","attr","get","error","xhr","userInfo","Object","certId","bVerify","mail","phone","taoId","regTime","alipayId","GLOBAL_NAV_DATA","userId","set","result","results","banklistArray","forEach","item","console","push","BankCard","bankCard","user_info","jumptoOrderListPage","click","hide","removeAttribute","removeAttr","date","day","getDate","month","year","getFullYear","s","isEmpty","ss","replace","str","OrderInfo","cardNum4","cardType"],"mappings":"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","file":"../alipay.js","sourcesContent":["dSpider(\"alipay\", function(session, env, $) {\n    log(\"current page url: \" + location.href);\n    var userInfoKey = 'userInfoKey'; //账号数据key\n    var monthArray = [];\n    var uploadMonArray = []; //上传的月份数据\n    var monCount = 3; //需要爬取的月份\n    var sumCount = monCount + 1;\n    var now = new Date();\n\n    // 增加判断当前页面是否是登录页\n    if ($(\"#J-loginMethod-tabs\").length && $(\"#J-loginMethod-tabs\").length > 0) {\n        session.setStartUrl();\n    }\n\n    //填充用户名密码\n    if (window.location.href.indexOf('/login/index.htm') != -1) {\n        session.showProgress(false);\n        hideElement();\n        if (session.getLocal(\"username\") != undefined && session.getLocal(\"pwd\") != undefined) {\n            $(\"#J-input-user\").val(session.getLocal(\"username\"));\n            $(\"#password_input\").val(session.getLocal(\"pwd\"));\n        }\n\n        $(\"#J-login-btn\")[0].onclick = function() {\n            session.setLocal(\"username\", $(\"#J-input-user\").val());\n            session.setLocal(\"pwd\", $(\"#password_input\").val());\n        };\n    }\n\n    //用户信息页面\n    if (window.location.href.indexOf('/account/index.htm') != -1) {\n        session.showProgress(true);\n        session.setProgressMax(100);\n        session.setProgress(0);\n\n        var delay = 200; //延迟200ms\n        setTimeout(function() {\n            fetchUserInfo();\n            jumptoBankPage();\n            session.setProgress(100.0 / (sumCount));\n        }, delay);\n    }\n\n    if (window.location.href.indexOf('/asset/bankList.htm') != -1) {\n        fetchBankList();\n    }\n\n    if (window.location.href.indexOf('/record/advanced.htm') != -1) {\n        switchVersion();\n    }\n\n    if (window.location.href.indexOf('/record/standard.htm') != -1) {\n        spideOrder();\n    }\n\n    //开始爬取交易记录\n    function spideOrder() {\n        var endDate = formateDate(now);\n        now.setMonth(now.getMonth() - 1);\n        var beginDate = formateDate(now);\n        log('--------------start spideOrder------------' + 'beginDate:' + beginDate + '|endDate:' + endDate)\n        fetchOrderListBy(1, beginDate, endDate);\n    }\n\n    //获取交易记录 pageNum:第几页  beginDate:开始时间  endDate:结束时间 //TODO:进度条还可以优化\n    function fetchOrderListBy(pageNum, beginDate, endDate) {\n        log('---------fetchOrderListBy--------------')\n        log('---------start spide order:【' + pageNum + '】page-------');\n        var daterange = 'customDate';\n        var beginTime = '00:00';\n        var endTime = '24:00';\n\n        $.ajax({\n            url: 'https://consumeprod.alipay.com/record/standard.htm',\n            type: 'post',\n            data: 'pageNum=' + pageNum + '&beginDate=' + beginDate + '&endDate=' + endDate + '&dateRange=' + daterange + '&beginTime=' + beginTime + '&endTime=' + endTime,\n            dataType: 'html',\n            async: true,\n            cache: false,\n            success: function(data) {\n                var res = $(data).find('#tradeRecordsIndex');\n                if ($(res).find('tbody:has(td)').length == 0) { //到达最后一页\n                    log('beginDate:' + beginDate + '|endDate:' + endDate + '|uploadMonArray:' + uploadMonArray);\n\n                    uploadMonArray = uploadMonArray.concat([{\n                        begin_date: beginDate,\n                        end_date: endDate,\n                        begin_time: beginTime,\n                        end_time: endTime,\n                        data: monthArray,\n                    }]);\n\n                    monCount = monCount - 1;\n                    session.setProgress(100.0 * (sumCount - monCount) / sumCount);\n\n                    if (monCount == 0) { //爬取结束\n                        log('----------------spideOrder finish!!!----------------- beginDate:' + beginDate + '|endDate:' + endDate + ' && monthArray:' + monthArray);\n                        var uploadData = {\n                            order_info: uploadMonArray\n                        };\n                        session.upload(uploadData);\n                        finish();\n                    } else { //爬取一个月的数据结束\n                        log('----------------spideOrder single_month over!!!----------------- beginDate:' + beginDate + '|endDate:' + endDate + ' && monthArray:' + monthArray);\n                        spideOrder();\n\n                    }\n                    monthArray = []; //上传后清空\n\n                } else {\n                    var offset = 0;\n                    var data = $(res).find('tbody').find('tr:has(td)').map(function(index) {\n                        if ($(this).find('td.title.td-refund')[0] !== undefined) {\n                            offset++;\n                            return { //TODO：退款的数据结构不一样\n                                name: formateStr($(this).find('td.title.td-refund').text()),\n                                time: '无',\n                                amount: formateStr($(this).find('td.amount.td-refund > p').text()),\n                                tradeNo: '无',\n                            };\n                        }\n                        var i = index + 1 - offset;\n                        return { //拼接上传数据\n                            name: formateStr($(this).find('p.consume-title').text()),\n                            time: formateStr($(this).find('td.time > p:nth-child(1)').text()) + '   ' + formateStr($(this).find('td.time > p:nth-child(2)').text()),\n                            amount: formateStr($(this).find('span.amount-pay').text()),\n                            tradeNo: formateStr($(this).find('#J-tradeNo-' + i).attr('title')),\n                        }\n                    }).get();\n\n                    monthArray = monthArray.concat(data);\n                    fetchOrderListBy(pageNum + 1, beginDate, endDate);\n                }\n\n            },\n            error: function(xhr, data) {\n                log(\"-----------spider【\" + pageNum + \"】page error!!!\");\n                finish();\n            }\n        });\n    }\n\n    //获取用户信息\n    function fetchUserInfo() {\n        log('--------------fetchUserInfo-----------------------')\n        var userInfo = new Object();\n        userInfo.name = $(\"#username\").text();\n        userInfo.certId = $('#account-main > div > table > tbody > tr:nth-child(1) > td:nth-child(2) > span:nth-child(3)').text();\n        userInfo.bVerify = $('#account-main > div > table > tbody > tr:nth-child(1) > td:nth-child(2) > span:nth-child(4)').text();\n        userInfo.mail = $('#account-main > div > table > tbody > tr:nth-child(2) > td:nth-child(2) > span').text();\n        userInfo.phone = $('#account-main > div > table > tbody > tr:nth-child(3) > td:nth-child(2) > span').text();\n        userInfo.taoId = $('#account-main > div > table > tbody > tr:nth-child(4) > td:nth-child(2)').text();\n        userInfo.regTime = $('#account-main > div > table > tbody > tr:nth-child(7) > td:nth-child(2)').text();\n        userInfo.alipayId = window.GLOBAL_NAV_DATA.userId;\n\n        session.set(userInfoKey, userInfo);\n    }\n\n    //获取银行卡列表\n    function fetchBankList() {\n        log('--------------fetchBankList-----------------------')\n        $.get(\"https://zht.alipay.com/asset/bindQuery.json?_input_charset=utf-8&providerType=BANK\", function(result) {\n            var data = result.results;\n            var banklistArray = [];\n            data.forEach(function(item) {\n                console.log(item);\n                banklistArray.push(new BankCard(item['providerName'], item['providerUserName'], item['cardTypeName']));\n            }, data);\n\n            var userInfo = session.get(userInfoKey);\n            userInfo.bankCard = banklistArray;\n            session.upload({\n                user_info: userInfo\n            });\n            log(userInfo);\n            jumptoOrderListPage();\n        });\n    }\n\n    //跳到交易记录\n    function jumptoBankPage() {\n        log('----------jumptoBankPage-----------')\n        location.href = \"https://zht.alipay.com/asset/bankList.htm\";\n    }\n    //跳到交易记录\n    function jumptoOrderListPage() {\n        log('----------jumptoOrderListPage-----------')\n        location.href = \"https://consumeprod.alipay.com/record/standard.htm\";\n    }\n\n    //切换交易记录显示版本（标准、高级）\n    function switchVersion() {\n        log('--------------switchVersion------------')\n        $('div.link > a')[0].click(function() {\n            location.href = $('#' + $(this).attr('rel')).attr('href');\n        });\n    }\n\n    //结束爬取\n    function finish() {\n        log(\"---------------spider end success------------------------\");\n        session.setProgress(100);\n        session.finish();\n    }\n\n    //隐藏其他与登陆无关的元素\n    function hideElement() {\n        $('#J-authcenter > div.authcenter-head').hide();\n        $('#J-authcenter-foot').hide();\n        $('#J-submit > p').hide();\n        $('#J-password > p').hide();\n        $('#J-qrcode > div.qrcode-footer > p.qrcode-footer-help').hide();\n        $('#J-authcenter > div.authcenter-body.fn-clear > h1 > a')[0].removeAttribute('href')\n        $('#J-errorBox > span > a').removeAttr(\"href\");\n    }\n\n    //转成标准格式字符串\n    function formateDate(date) {\n        var day = date.getDate();\n        var month = date.getMonth() + 1;\n        var year = date.getFullYear();\n        return year + '.' + month + '.' + day;\n    }\n\n    //去除多余转义字符,前后空格\n    function formateStr(s) {\n        if (!isEmpty(s)) {\n            var ss = s.replace(/(^\\s*)|(\\s*$)/g, '');\n            return ss.replace(/[\\'\\\"\\\\\\/\\b\\f\\n\\r\\t]/g, '');\n        }\n        return '';\n    }\n\n    function isEmpty(str) {\n        return (!str || 0 === str.length);\n    }\n\n    //用户信息\n    function userInfo(name, mail, phone, taoId, regTime, certId, bVerify, bankCard, alipayId) {\n        this.name = name; //真实名字\n        this.mail = mail; //邮箱\n        this.phone = phone; //手机号\n        this.taoId = taoId; //淘宝id\n        this.regTime = regTime; //注册时间\n        this.certId = certId; //身份证\n        this.bVerify = bVerify; //是否认证\n        this.bankCard = bankCard; //绑定银行卡个数\n        this.alipayId = alipayId; //支付宝ID\n    }\n\n    //交易记录\n    function OrderInfo(name, time, amount, tradeNo) {\n        this.name = name; //交易名字\n        this.time = time; //交易时间\n        this.amount = amount; //交易金额\n        this.tradeNo = tradeNo; //流水号\n    }\n\n    //银行卡\n    function BankCard(name, cardNum4, cardType) {\n        this.name = name; //银行名字\n        this.cardNum4 = cardNum4; //尾号\n        this.cardType = cardType; //卡类型\n    }\n\n})\n"]}