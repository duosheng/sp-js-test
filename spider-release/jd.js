!function e(r,t,o){function n(d,s){if(!t[d]){if(!r[d]){var a="function"==typeof require&&require;if(!s&&a)return a(d,!0);if(i)return i(d,!0);throw new Error("Cannot find module '"+d+"'")}var c=t[d]={exports:{}};r[d][0].call(c.exports,function(e){var t=r[d][1][e];return n(t?t:e)},c,c.exports,e,r,t,o)}return t[d].exports}for(var i="function"==typeof require&&require,d=0;d<o.length;d++)n(o[d]);return n}({1:[function(e,r,t){"use strict";dSpider("jd",function(e,r,t){function o(){function r(d){t.getJSON("https://home.m.jd.com//newAllOrders/newAllOrders.json?sid="+g+"&page="+d,function(a){if(d++,!(m.order_info.order_detail.length<=_&&0!=a.orderList.length)||0!=o.order_detail.length&&a.orderList[a.orderList.length-1].orderId==o.order_detail[o.order_detail.length-1].orderId)return log("finish"),s(),e.setProgress(60),void i();o.order_detail=o.order_detail.concat(a.orderList);var c=[];m.order_info.order_detail.length<_&&(a.orderList.length+m.order_info.order_detail.length>_&&(a.orderList=a.orderList.slice(0,_-m.order_info.order_detail.length)),c.push(t.each(a.orderList,function(e,r){log("task push orderId: "+a.orderList[e].orderId),t.ajax({type:"get",url:"https://home.m.jd.com/newAllOrders/queryOrderDetailInfo.action?orderId="+a.orderList[e].orderId+"&from=newUserAllOrderList&passKey="+a.passKeyList[e]+"&sid="+g,async:!1,success:function(r){log("orderId: "+a.orderList[e].orderId);var o=t.trim(t("<div>").append(t(r)).find(".step2-in-con").text()),n=new h(a.orderList[e].orderId,a.orderList[e].dataSubmit,a.orderList[e].price,o);n.products=[];var i=t("<div>").append(t(r)).find(".pdiv");t.each(i,function(e,r){var o=t.trim(t("<div>").append(i[e]).find(".sitem-m-txt").text()),d=t.trim(t("<div>").append(i[e]).find(".sitem-r").text()),s=t.trim(t("<div>").append(i[e]).find(".s3-num").text());n.products.push(new u(o,s,d))}),Date.parse(new Date)<new Date(n.time.split(" ")[0]).getTime()+24*v*60*60*1e3&&m.order_info.order_detail.length<_&&m.order_info.order_detail.push(n)}})}))),t.when(c).done(function(){log("get page :"+d),log("count: "+m.order_info.order_detail.length),r(d),m.order_info.order_detail.sort(n())})})}e.setProgress(40),m=e.get(p);var o=new l([]);m.order_info=new l([]),m.order_info.order_detail=[],r(1)}function n(){return function(e,r){var t=new Date(e.time.split(" ")[0]).getTime(),o=new Date(r.time.split(" ")[0]).getTime();return o-t}}function i(){location.href="http://home.m.jd.com/user/accountCenter.action"}function d(){location.href="https://passport.m.jd.com/user/logout.action?sid="+e.get("sid"),e.setProgress(100),e.upload(e.get(p)),e.finish()}function s(){e.set(p,m)}function a(e,r,t){this.site_id=2,this.base_info=e,this.contact_info=r,this.order_info=t}function c(e){this.contact_detail=e}function f(e,r,t,o,n){this.name=e,this.location=r,this.address=t,this.phone=o,this.zipcode=n}function l(e){this.order_detail=e}function h(e,r,t,o){this.id=e,this.time=r,this.total=t,this.address=o}function u(e,r,t){this.name=e,this.number=r,this.price=t}var m,p="infokey",g="",_=30,v=1e3;if(g=e.get("sid"),location.href.indexOf("://m.jd.com")!=-1&&(e.showProgress(!0),e.setProgressMax(100),e.autoLoadImg(!1),e.setProgress(5),void 0!=t(".jd-search-form-input")[0]&&(g=t(".jd-search-form-input")[0].children[0].value,e.set("sid",g)),e.set(p,new a({},{},{})),m=e.get(p),m.base_info.username=t("[report-eventid$='MCommonHTail_Account']").text().replace(/\n/g,"").replace(/\t/g,""),s(),e.setProgress(10),location.href="http://home.m.jd.com/maddress/address.action?"),location.href.indexOf("://home.m.jd.com/maddress")!=-1){e.setProgress(20),m=e.get(p),x=new c([]);for(var L=[],w=t(".ia-r"),b=0;b<w.length;b++)L.push(t.get(w[b],function(e,r){var o=t("<div>").append(t(e)),n=t.trim(o.find("#uersNameId")[0].value),i=t.trim(o.find("#mobilePhoneId")[0].value),d=t.trim(o.find("#addressLabelId")[0].innerHTML),s=t.trim(o.find("#address_where")[0].innerHTML);x.contact_detail.push(new f(n,d,s,i,""))}));t.when.apply(t,L).done(function(){m.contact_info=x,s(),e.setProgress(30),o()})}location.href.indexOf("://home.m.jd.com/user/accountCenter.action")!=-1&&location.href.indexOf("loginpage")==-1&&(e.setProgress(70),void 0!=t("#shimingrenzheng")[0]&&t("#shimingrenzheng")[0].click()),location.href.indexOf("msc.jd.com/auth/loginpage/wcoo/toAuthInfoPage")!=-1&&(e.setProgress(90),m=e.get(p),void 0!=t(".pos-ab")[0]&&(m.base_info.name=t(".pos-ab")[0].innerHTML),void 0!=t(".pos-ab")[1]&&(m.base_info.idcard_no=t(".pos-ab")[1].innerHTML),s(),d()),location.href.indexOf("msc.jd.com/auth/loginpage/wcoo/toAuthPage")!=-1&&(e.setProgress(90),m=e.get(p),void 0!=t("#username")[0]&&(m.base_info.name=t("#username")[0].innerHTML),void 0!=t(".info-user-name")[0]&&(m.base_info.name=t(".info-user-name")[0].innerHTML),void 0!=t("#idcard")[0]&&(m.base_info.idcard_no=t("#idcard")[0].innerHTML),void 0!=t(".pos-ab[data-cardno]")&&(m.base_info.idcard_no=t(".pos-ab[data-cardno]").attr("data-cardno")),s(),d());var x;t("#loginOneStep").length&&t("#loginOneStep").length>0&&e.setStartUrl()})},{}]},{},[1]);
//# sourceMappingURL=sources_maps/jd.js.map
