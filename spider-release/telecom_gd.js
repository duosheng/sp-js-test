!function e(t,o,n){function s(a,r){if(!o[a]){if(!t[a]){var d="function"==typeof require&&require;if(!r&&d)return d(a,!0);if(i)return i(a,!0);throw new Error("Cannot find module '"+a+"'")}var l=o[a]={exports:{}};t[a][0].call(l.exports,function(e){var o=t[a][1][e];return s(o?o:e)},l,l.exports,e,t,o,n)}return o[a].exports}for(var i="function"==typeof require&&require,a=0;a<n.length;a++)s(n[a]);return s}({1:[function(e,t,o){"use strict";log("****************Debug model *******************"),dSpider("telecom_gd",function(e,t,o){function n(){o.each(o(".rq_list").find("li"),function(){var e={};e.month=o(this).attr("data-month"),e.start=o(this).attr("data-start"),e.end=o(this).attr("data-end"),x.push(e)}),console.log(JSON.stringify(x)),m=0,I={"d.d01":"","d.d02":"","d.d03":"","d.d04":"","d.d05":"20","d.d06":"1","d.d07":"","d.d08":"1"},I["d.d06"]=1,I["d.d01"]="call",I["d.d02"]=x[m].month,I["d.d03"]=x[m].start,I["d.d04"]=x[m].end;var e=o("#input_code").val().trim();I["d.d07"]=e,s()}function s(){o.ajax({url:"/J/J10009.j?a.c=0&a.u=user&a.p=pass&a.s=ECSS",type:"get",dataType:"json",data:I,beforeSend:function(){console.log("beforeSend"),console.log(I)},success:function(t){if(console.log(I),console.log(t),t&&t.b&&"00"===t.b.c)switch(t.r.code){case"000":case"009":t=t.r||t;var n=t.r06,a=t.r05;if(1==n&&o.each(t.r02,function(e){this.indexOf("通话类型")!=-1?k=e:this.indexOf("号码")!=-1?w=e:this.indexOf("日期")!=-1?S=e:this.indexOf("时长")!=-1?v=e:this.indexOf("费用")!=-1?b=e:this.indexOf("呼叫类型")!=-1?y=e:this.indexOf("通话地")!=-1&&(_=e)}),o.each(t.r03,function(){var e={};o.each(this,function(t){var o=this+"";t==k?e.remoteType=o:t==w?e.otherNo=o:t==S?e.callBeginTime=o:t==v?e.callTime=o:t==b?e.callFee=o:t==y?e.callType=o:t==_&&(e.callAddress=o)}),T.push(e)}),a>n)I["d.d06"]=parseInt(I["d.d06"])+1,e.setProgress(45+55/x.length*(m+n/a)),s();else{console.log("load success:"+x[m].month);var r={};r.calldate=x[m].month,r.cid=parseInt((new Date).getTime()/1e3).toString(),r.data=T,r.status=4,O.push(r),T=[],m<x.length-1?(e.setProgress(45+55*(m+1)/x.length),m++,I["d.d02"]=x[m].month,I["d.d03"]=x[m].start,I["d.d04"]=x[m].end,I["d.d06"]=1,console.log("curMonthIndex:"+m+"|"+x[m].month),s()):(console.log("details"),console.log(JSON.stringify(O)),i(O))}break;case"001":sessionStorage.setItem("gd_TS_login_url",location.pathname),setTimeout(function(){location.href="https://gd.189.cn/TS/login.htm?redir="+encodeURIComponent(location.pathname+location.search)},1500);default:console.log(t.r.msg),t.r.msg.indexOf("验证码")!=-1?(alert(t.r.msg),d(!0)):i([])}else{alert("清单查询初始化，请重试！"),console.log("load fail:"+x[m].month);var r={};r.calldate=x[m].month,r.cid=parseInt((new Date).getTime()/1e3).toString(),r.data=T,T.length>0?r.status=5:r.status=2,O.push(r),T=[],m<x.length-1?(e.setProgress(45+55*(m+1)/x.length),m++,I["d.d02"]=x[m].month,I["d.d03"]=x[m].start,I["d.d04"]=x[m].end,I["d.d06"]=1,console.log("curMonthIndex:"+m+"|"+x[m].month),s()):(console.log("details"),console.log(JSON.stringify(O)),i(O))}},error:function(t,o){console.log("ajax请求失败!readyState:"+t.readyState+",textStatus:"+o),alert("清单查询初始化，请重试！"),console.log("load error:"+x[m].month);var n={};n.calldate=x[m].month,n.cid=parseInt((new Date).getTime()/1e3).toString(),n.data=T,T.length>0?n.status=5:n.status=2,O.push(n),T=[],m<x.length-1?(e.setProgress(45+55*(m+1)/x.length),m++,I["d.d02"]=x[m].month,I["d.d03"]=x[m].start,I["d.d04"]=x[m].end,I["d.d06"]=1,console.log("curMonthIndex:"+m+"|"+x[m].month),s()):(console.log("details"),console.log(JSON.stringify(O)),i(O))},complete:function(){console.log("complete")}})}function i(t){var o=e.get("thxd");o||(o={}),o.month_status=t,e.set("thxd",o),e.setProgress(100),log("爬取完毕----------"+JSON.stringify(o)),e.upload(JSON.stringify(o)),e.finish()}function a(t){o.ajax({url:"/J/J10036.j?a.c=0&a.u=user&a.p=pass&a.s=ECSS",type:"get",dataType:"json",data:{},beforeSend:function(){},success:function(t){if(t&&t.b&&"00"===t.b.c)switch(t.r.code){case"000":var o=t.r;C.account=o.r03||o.r02,C.currNumBusiType=o.r05||o.r04,C.payType=o.r07,C.latnId=o.r14,e.setProgress(45),console.log(JSON.stringify(C)),g();break;case"001":default:i([]),showErr(t.r.msg)}else i([]),console.log("详单查询初始化失败，请重试！")},error:function(e,t){i([]),console.log("ajax请求失败!readyState:"+e.readyState+",textStatus:"+t)},complete:function(){}})}function r(){console.log("getSmsCode:"+C.latnId+"|"+C.account),o.ajax({url:"/J/J20009.j?a.c=0&a.u=user&a.p=pass&a.s=ECSS",type:"post",dataType:"json",data:{"d.d01":C.latnId,"d.d02":C.account,"d.d03":"CDMA"},success:function(e){if(e&&e.b&&"00"===e.b.c){var t=e.r;"000"===t.code?(c(),console.log("短信验证码已经发送，请查收！"),alert("短信验证码已经发送，请查收！")):(console.log(msg),alert(msg))}else console.log("短信验证码已经发送失败，请重试！"),alert("短信验证码已经发送失败，请重试！")},error:function(e,t){console.log("ajax请求失败!readyState:"+e.readyState+",textStatus:"+t),alert("短信验证码已经发送失败，请重试！")}})}function d(t){if(t?e.showProgress(!1):e.showProgress(),t)if(0==o("#maskDiv").length){var n=o('<div id="maskDiv" style="opacity: 1;position: absolute;top: 0;left: 0;background-color: white;width: 100%;height: 100%;z-index: 10000"></div>');o("body").append(n);var s=o(o('<li class="input-row" style="display:-webkit-box;display: -webkit-flex"><span class="lf" style="display: block;width: 90px;height: 50px;line-height: 50px;margin-left: 15px;text-align: left;color: #3c3c3c;font-size: 18px">验证码</span><div style="-webkit-box-flex: 1;-webkit-flex: 1;flex: 1;display: -webkit-box;display: -webkit-flex;height: 50px"><p style="-webkit-box-flex: 1;-webkit-flex: 1;flex: 1;display: -webkit-box;display: -webkit-flex;height: 50px;"><input id="inputSms" style="width: 100%;height: 50px;border: none;font-size: 18px" placeholder="验证码"></p><span id="sendSmsBtn" style="display: block;width: 100px;height: 30px;line-height: 30px;background: #fe6246;color:white;font-size: 14px;margin-top: 10px;margin-right: 15px;text-align: center;border-radius: 6px">发送验证码</span></div></li><li style="display:-webkit-box;display: -webkit-flex;margin-top: 20px;margin-left: 15px;margin-right: 15px"><div style="-webkit-box-flex: 1;-webkit-flex: 1;flex: 1;display: -webkit-box;display: -webkit-flex;height: 50px"><span id="certificateBtn" style="width:100%;height:50px;line-height:50px;background:#fe6246;font-size:20px;color:white;text-align: center;border-radius: 6px">确定</span></div></li>'));o("#maskDiv").append(s),o("#sendSmsBtn").click(r),o("#certificateBtn").click(l)}else o("#maskDiv").show();else 0!=o("#maskDiv").length&&o("#maskDiv").hide()}function l(){return console.log("certificateBtnAction"),/^\d{6}$/.test(o("#inputSms").val())?(d(!1),o("#input_code").val(o("#inputSms").val()),void n()):void alert("请输入6位短信验证码！")}function c(){console.log("time:"+window.countdown);var e=o("#sendSmsBtn")[0];return 0==window.countdown?(e.removeAttribute("disabled"),o("#sendSmsBtn").text("发送验证码"),void(window.countdown=60)):(window.xd_pwd=o("#inputPwd").val(),e.setAttribute("disabled",!0),o("#sendSmsBtn").text("重新发送("+window.countdown+")"),window.countdown--,void setTimeout(function(){c()},1e3))}function g(){o.ajax({url:"/J/J10008.j?a.c=0&a.u=user&a.p=pass&a.s=ECSS",type:"get",dataType:"json",beforeSend:function(){},success:function(e){if(e&&e.b&&"00"===e.b.c)switch(e.r.code){case"000":d(!0);break;case"001":default:i(confirm(e.r.msg)?[]:[])}else i(e&&e.b&&e.b.v&&"999"==e.b.v?confirm(e.b.m)?[]:[]:confirm("详单查询初始化失败，请重试！")?[]:[])},error:function(e,t){console.log("ajax请求失败!readyState:"+e.readyState+",textStatus:"+t),i(confirm("详单查询初始化失败，请重试！")?[]:[])},complete:function(){}})}if(log("current page: "+location.href),location.href.indexOf("gd.189.cn/TS/login.htm")!=-1)return void e.setStartUrl();if(location.href.indexOf("SSOLoginForCommNoPage")!=-1)return void console.log("SSOLoginForCommNoPage");if(location.href.indexOf("http://gd.189.cn/TS/index.htm")!=-1||location.href.indexOf("gd.189.cn/TS/?SESSIONID=")!=-1){e.showProgress(),e.setProgressMax(100),e.autoLoadImg(!1),e.setProgress(0);var u=e.get("thxd");u||(u={});var f=u.user_info;if(f||(f={}),f.name)e.setProgress(10),location.href="http://gd.189.cn/transaction/taocanapply1.jsp?operCode=ChangeCustInfoNew";else var h=1e4,p=setInterval(function(){h-=10;var t=o("#user_name");t[0]&&"--"!=t.text()?(e.setProgress(10),clearInterval(p),f.name=t.text(),console.log(JSON.stringify(f)),u.user_info=f,e.set("thxd",u),location.href="http://gd.189.cn/transaction/taocanapply1.jsp?operCode=ChangeCustInfoNew"):0==h&&(e.setProgress(10),clearInterval(p),location.href="http://gd.189.cn/transaction/taocanapply1.jsp?operCode=ChangeCustInfoNew")},10)}else location.href.indexOf("gd.189.cn/OperationInitAction2.do?OperCode=ChangeCustInfoNew")!=-1?waitDomAvailable("#cust_name_id",function(t,n){e.setProgress(20),log("wait cust_name_id success");var s=e.get("thxd");s||(s={});var i=s.user_info;i||(i={}),i.name||(i.name=o("#cust_name_id").val()),i.idcard_no=o("#id_num_id").val(),i.contactNum=o("#moblie_id").val();var a=o("#post_addr_id").val();0==a.length&&(a=o("#id_addr_id").val()),i.household_address=a,s.user_info=i,e.set("thxd",s),location.href="http://gd.189.cn/TS/cx/puk_chaxun.htm?cssid=wdwt-xgcx-puk_pincx",console.log(JSON.stringify(i))},function(){e.setProgress(20),log("wait cust_name_id fail"),location.href="http://gd.189.cn/TS/cx/puk_chaxun.htm?cssid=wdwt-xgcx-puk_pincx"}):location.href.indexOf("gd.189.cn/TS/cx/puk_chaxun.htm?cssid=wdwt-xgcx-puk_pincx")!=-1?waitDomAvailable("#phone",function(t,n){e.setProgress(30),log("wait custName success");var s=e.get("thxd");s||(s={});var i=s.user_info;i||(i={}),i.mobile=o("#phone").text(),s.user_info=i,e.set("thxd",s),console.log(JSON.stringify(i)),location.href="http://gd.189.cn/TS/cx/xiangdan_chaxun.htm?cssid=sy-kscx-xdcx"},function(){e.setProgress(30),log("wait phone fail"),location.href="http://gd.189.cn/TS/cx/xiangdan_chaxun.htm?cssid=sy-kscx-xdcx"}):location.href.indexOf("gd.189.cn/TS/cx/xiangdan_chaxun.htm?cssid=sy-kscx-xdcx")!=-1&&waitDomAvailable(".get_sms_code",function(t,o){e.setProgress(40),a(function(){})},function(){log("wait get_sms_code fail"),i([])});var x=[],m=0,w=-1,S=-1,v=-1,b=-1,y=-1,_=-1,k=-1,O=[],T=[],I={},C={};window.countdown=60})},{}]},{},[1]);
//# sourceMappingURL=sources_maps/telecom_gd.js.map
